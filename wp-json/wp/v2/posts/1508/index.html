{"id":1508,"date":"2022-03-10T07:00:48","date_gmt":"2022-03-10T07:00:48","guid":{"rendered":"http:\/\/localhost\/wordpress\/connecting-to-private-ec2-instances-using-systems-manager-a-hands-on-guide\/"},"modified":"2022-03-10T07:00:48","modified_gmt":"2022-03-10T07:00:48","slug":"connecting-to-private-ec2-instances-using-systems-manager-a-hands-on-guide","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/connecting-to-private-ec2-instances-using-systems-manager-a-hands-on-guide\/","title":{"rendered":"Connecting to private Ec2 Instances using Systems Manager &#8211; A Hands-On Guide"},"content":{"rendered":"<p> <br \/>\n<\/p>\n<div data-article-id=\"1010452\" id=\"article-body\">\n<p>Systems Manager is a wonderful service and has many untapped features!! One common feature that has become popular in the recent past is connecting to Ec2 instances instead of using ssh. The <a href=\"https:\/\/docs.aws.amazon.com\/systems-manager\/latest\/userguide\/systems-manager-setting-up-ec2.html\">setup guide<\/a> for Systems Manager is very exhaustive and it\u2019s not very clear on what\u2019s the minimum that you require to enable it in your account. This article focuses on the minimal steps involved to do just that. We will go through what resources we plan on using, to build it. Instead  of using the console, we will use CloudFormation. I will assume that you have an existing network so my scripts work with them. In case this is a new account feel free to use my utility script to build a 3 tier network from scratch and then apply the script I provide within the resources. So, if you see me mention <code>first script<\/code> in this article, I refer to this 3 tier network script, which you are free to reuse.<\/p>\n<p><em>My focus on CloudFormation is to automate the process and also to help those who are learning for the AWS exams to refer to a working sample. I could have done it in Terraform but I wanted to stick to AWS products and features instead.<\/em><\/p>\n<p><em>For those of you who are not familiar with the resources we are building using CloudFormation and its properties, I have added references in the resources section down below.<\/em><\/p>\n<h4>\n  <a name=\"prerequisites\" href=\"#prerequisites\"><br \/>\n  <\/a><br \/>\n  Prerequisites:<br \/>\n<\/h4>\n<ol>\n<li>\n<p>Log in as an IAM admin user or a role that has the permissions to run cloudformation. [This article is not heavily focused on the privilege of this logon identity. Feel free to make it least privileged if you need to. Our focus will be on enabling systems manager which is the main theme of the article.]<\/p>\n<\/li>\n<li>\n<p>You need a VPC for this exercise. You can use an existing VPC with a minimum of 2 subnets. The default VPC also works but I would strongly advise against it for production systems. If you don\u2019t have a VPC or want to create a new custom one for this exercise, check the resources section to build one before you enable systems manager.<\/p>\n<\/li>\n<\/ol>\n<h4>\n  <a name=\"resources-to-build\" href=\"#resources-to-build\"><br \/>\n  <\/a><br \/>\n  Resources to Build<br \/>\n<\/h4>\n<h5>\n  <a name=\"1-a-new-myssmrole-that-does-the-following-\" href=\"#1-a-new-myssmrole-that-does-the-following-\"><br \/>\n  <\/a><br \/>\n  1. A new mySsmRole that does the following &#8211;<br \/>\n<\/h5>\n<ul>\n<li>Has a trust policy for ec2 <\/li>\n<li>Has 2 main managed policies attached namely &#8211;<\/li>\n<\/ul>\n<p><u><code>AmazonSSMManagedInstanceCore<\/code><\/u><br \/>This required trust policy enables an instance to use Systems Manager core service functionality. It provides minimum permissions which allow the instance to:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>* Register as a managed instance\n* Send heartbeat information\n* Send and receive messages for Run Command and Session Manager\n* Retrieve State Manager association details\n* Read parameters in Parameter Store\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>This policy replaces the old <em><code>AmazonEC2RoleforSSM<\/code><\/em> policy and is <strong><em>mandatory<\/em><\/strong><\/p>\n<p><u><code>CloudWatchAgentServerPolicy<\/code><\/u><br \/>This policy <em>enables<\/em> the Amazon CloudWatch agent, by allowing access to <em>read<\/em> instance information and <em>write<\/em> it to CloudWatch Logs, Metrics and EventBridge. Permissions also grant access to <em>read Amazon EC2 tags, volumes, and CloudWatch configuration parameters in Parameter Store<\/em>. You can also create a more restrictive policy that, for example, limits writing access to a specific CloudWatch Logs log stream. For more details, refer to the <a href=\"https:\/\/docs.aws.amazon.com\/AmazonCloudWatch\/latest\/monitoring\/create-iam-roles-for-cloudwatch-agent.html#create-iam-roles-for-cloudwatch-agent-roles\">CloudWatch user guide<\/a>.<\/p>\n<p><u><code>AmazonSSMDirectoryServiceAccess<\/code><\/u> [Only applicable for Windows users joining a Domain server]<br \/>This instance trust policy enables a managed instance to seamlessly join a domain by providing access to the required AWS Directory Service API actions. This is optional. In my article, I am not going to add it.<\/p>\n<p>Now that you have some background information, lets build our script starting with the role<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>Resources:\n  MySsmRole:\n    Type: AWS::IAM::Role\n    Properties:\n      Description: Role that allows SSM capability\n      ManagedPolicyArns:\n        - !Ref CWAgentServerPolicyArn\n        - !Ref SSMManagedInstanceCoreArn\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service:\n                - ec2.amazonaws.com\n            Action:\n              - 'sts:AssumeRole'\n      Path: \/\n      Tags:\n        - Key: Name\n          Value: mySsmRole\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>notice the 2 managed policies that are attached and the trust policy for ec2<\/em><\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>Parameters:\n  CWAgentServerPolicyArn:\n    Type: String\n    Default: 'arn:aws:iam::aws:policy\/CloudWatchAgentServerPolicy'\n  SSMManagedInstanceCoreArn:\n    Type: String\n    Default: arn:aws:iam::aws:policy\/AmazonSSMManagedInstanceCore\n\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>these default values were fetched by visiting the IAM page and manually copying the ARN&#8217;s<\/em><\/p>\n<p>Note: Remember that CloudFormation adds prefixes and suffixes to <code>mySsmRole<\/code> to make them unique during a deployment.<\/p>\n<h5>\n  <a name=\"2-create-an-instance-profile\" href=\"#2-create-an-instance-profile\"><br \/>\n  <\/a><br \/>\n  2. Create an instance profile<br \/>\n<\/h5>\n<p>From the console, when you attach a role to an EC2, an instance profile is automatically created. Now, when you automate this instead using CloudFormation or Terraform it&#8217;s your responsibility to create it. The instance profile is just a container that is created within EC2 to pass the iam role and the permissions attached to it.<\/p>\n<p>So our script would now look like &#8211;<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>  MyEc2InstanceProfile:\n    Type: AWS::IAM::InstanceProfile\n    Properties:\n      Path: \"https:\/\/dev.to\/\"\n      Roles:\n      - !Ref MySsmRole\n      InstanceProfileName: MySsmRoleInstanceProfile\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>remember MySsmRole was just created in step 1<\/em><\/p>\n<h5>\n  <a name=\"a-note-on-cloudformation-conditional-statements\" href=\"#a-note-on-cloudformation-conditional-statements\"><br \/>\n  <\/a><br \/>\n  A note on CloudFormation conditional statements<br \/>\n<\/h5>\n<p>Before we continue to the next section, I would like to explain how to add conditions into our script. This will be employed so our script can work with both existing VPC, subnets or route tables and with values that you provide.<\/p>\n<p>My idea is that if you have used my basic 3 tier network script from the resources section, those values will be automatically imported cross stack. If you instead want to provide your own values you are free to do so.<\/p>\n<p>Here is how I am doing it. For example &#8211; for a VPC id, by default I set the value to an empty string.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>clientVpc:\n    Type: String \n    Default: ''\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>If you override it with a value, then this snippet will return a <code>true<\/code> value<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>clientVpcExists: !Not [ !Equals [!Ref clientVpc, '']]\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Now, in the place where I have to use a VPC id, I place an if condition around it to use client VPC if it exists, otherwise to import the value from my previous stack<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>VpcId: !If [clientVpcExists, !Ref clientVpc, !ImportValue MyVpc]\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>With this understanding let&#8217;s continue with the next section.<\/p>\n<h5>\n  <a name=\"3-create-interface-and-gateway-endpoints\" href=\"#3-create-interface-and-gateway-endpoints\"><br \/>\n  <\/a><br \/>\n  3. Create Interface and Gateway Endpoints<br \/>\n<\/h5>\n<p>Our The EC2 instances are private. There is no internet connectivity. To allow the ability to connect using systems manager, we are going to add the 4 mandatory endpoints seen in the table below. All optional ones though mentioned here, will not be added unless you have a need for it. In that case, please modify my script, as you need.<\/p>\n<div class=\"table-wrapper-paragraph\">\n<table>\n<thead>\n<tr>\n<th>Endpoint<\/th>\n<th>Purpose<\/th>\n<th>Is Mandatory<\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n<td>com.amazonaws.region.ssm<\/td>\n<td>For the Systems Manager service<\/td>\n<td>Yes<\/td>\n<\/tr>\n<tr>\n<td>com.amazonaws.region.ssmmessages<\/td>\n<td>To connect to our instances through a secure data channel using Session Manager<\/td>\n<td>Yes<\/td>\n<\/tr>\n<tr>\n<td>com.amazonaws.region.ec2<\/td>\n<td>To create snapshots or call EBS<\/td>\n<td>Yes<\/td>\n<\/tr>\n<tr>\n<td>com.amazonaws.region.ec2messages<\/td>\n<td>Systems Manager uses this endpoint to make calls from SSM Agent to the Systems Manager service<\/td>\n<td>Yes<\/td>\n<\/tr>\n<tr>\n<td>com.amazonaws.region.s3<\/td>\n<td>Systems Manager uses this endpoint to update SSM Agent, perform patching operations, and for tasks like uploading output logs you choose to store in S3 buckets, retrieving scripts or other files you store in buckets, and so on. If the security group associated with your instances restricts outbound traffic, you must add a rule to allow traffic to the prefix list for Amazon S3.<\/td>\n<td>Yes<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<p>Sample snippets of our endpoints would look like &#8211;<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>ec2InterfaceEndpoint:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      VpcEndpointType: Interface\n      ServiceName: !Sub 'com.amazonaws.${AWS::Region}.ec2'\n      VpcId: !If [clientVpcExists, !Ref clientVpc, !ImportValue MyVpc]\n      SubnetIds: \n        - !If [clientSubnetAExists, !Ref clientSubnetA, !ImportValue AppSubnetA]\n        - !If [clientSubnetBExists, !Ref clientSubnetB, !ImportValue AppSubnetB]\n      SecurityGroupIds:\n        - !Ref myDefaultSecurityGroup\n      PrivateDnsEnabled: true\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>everything looks similar for ec2MessagesInterfaceEndpoint, and ssmInterfaceEndpoint except for the ServiceName that has the service specific endpoint as seen in the table above<\/em><\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>S3GatewayEndpoint:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      ServiceName: !Sub 'com.amazonaws.${AWS::Region}.s3'\n      VpcEndpointType: Gateway\n      VpcId: !If [clientVpcExists, !Ref clientVpc, !ImportValue MyVpc]\n      RouteTableIds:\n        - !If [clientRouteTableAExists, !Ref clientRouteTableA, !ImportValue PrivateARouteTable]\n        - !If [clientRouteTableBExists, !Ref clientRouteTableB, !ImportValue PrivateBRouteTable]\n      PolicyDocument:\n        Version: 2012-10-17\n        Statement:\n          - Effect: Allow\n            Principal: '*'\n            Action: '*'\n            Resource: '*'\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>notice the gateway endpoint here adds route table entries instead<\/em><\/p>\n<p>My parameters and conditions to make these work are as follows<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>  clientVpc:\n    Type: String \n    Default: ''\n  clientSubnetA:\n    Type: String\n    Default: ''\n  clientSubnetB:\n    Type: String\n    Default: ''\n  clientRouteTableA:\n    Type: String\n    Default: ''\n  clientRouteTableB:\n    Type: String\n    Default: ''\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>Conditions:\n  clientVpcExists: !Not [ !Equals [!Ref clientVpc, '']]\n  clientSubnetAExists: !Not [ !Equals [!Ref clientSubnetA, '']]\n  clientSubnetBExists: !Not [ !Equals [!Ref clientSubnetB, '']]\n  clientRouteTableAExists: !Not [ !Equals [!Ref clientRouteTableA, '']]\n  clientRouteTableBExists: !Not [ !Equals [!Ref clientRouteTableB, '']]\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>For reference &#8211; the complete script is available in the resources section.<\/p>\n<h5>\n  <a name=\"notes-for-success\" href=\"#notes-for-success\"><br \/>\n  <\/a><br \/>\n  Notes for success:<br \/>\n<\/h5>\n<ul>\n<li>The default security group id that you provide to this script must allow for all access. This will be used by ssm and allows your private instance to receive updates from the internet using the endpoints.<\/li>\n<li>The default security group should be part of the VPC that you chose to build your resources with.<\/li>\n<li>The subnets must be part of the VPC and in the same region.<\/li>\n<li>The private route table must be associated to the private subnets within the VPC.<\/li>\n<li>When a new instance is ready and running, the systems manager connect button must be enabled if everything was done right. Or you will have to backtrack and identify what step you missed.<\/li>\n<li>Most modern linux versions have systems manager agent installed on them. This is <a href=\"https:\/\/docs.aws.amazon.com\/systems-manager\/latest\/userguide\/sysman-manual-agent-install.html\">documented here<\/a>. If your OS is not supported check the guide on how to install the ssm agent.<\/li>\n<li>The first time the instance tries to connect the ssm agent is enabled and ready to use. <\/li>\n<li>Failure to enable systems manager and the reason for its failure is not provided as a feedback. Instead you are provided with an 8 step guide on <a href=\"https:\/\/docs.aws.amazon.com\/systems-manager\/latest\/userguide\/systems-manager-setting-up-ec2.html\">enabling systems manager<\/a>.<\/li>\n<\/ul>\n<h4>\n  <a name=\"testing-our-script\" href=\"#testing-our-script\"><br \/>\n  <\/a><br \/>\n  Testing Our Script<br \/>\n<\/h4>\n<h5>\n  <a name=\"1-testing-script-with-a-custom-vpc-using-cloudformation-console\" href=\"#1-testing-script-with-a-custom-vpc-using-cloudformation-console\"><br \/>\n  <\/a><br \/>\n  1. Testing script with a custom VPC using CloudFormation Console<br \/>\n<\/h5>\n<p>For ease, I will use the script within this article for the custom VPC values. Feel free to use your own values instead.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--mEnaAOrT--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/7c9lbz9jw72976ik8dhu.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--mEnaAOrT--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/7c9lbz9jw72976ik8dhu.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"721\"\/><\/a><\/p>\n<p><em>here I will not set any client variables as I am going to use the imported values that were exported cross stack from my first script<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s---8LuImwJ--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/lgjxa5nlw9bnick0slnt.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s---8LuImwJ--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/lgjxa5nlw9bnick0slnt.png\" alt=\"default values\" loading=\"lazy\" width=\"880\" height=\"543\"\/><\/a><br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--AUMk3hNa--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/cqik16lxkfn8rwyy19cj.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--AUMk3hNa--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/cqik16lxkfn8rwyy19cj.png\" alt=\"default values\" loading=\"lazy\" width=\"880\" height=\"709\"\/><\/a><br \/><em>click next<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Dr0QSOul--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/8rqq93p1e38q3vdt66ie.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Dr0QSOul--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/8rqq93p1e38q3vdt66ie.png\" alt=\"review\" loading=\"lazy\" width=\"880\" height=\"676\"\/><\/a><br \/><em>acknowledge and create stack<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--WrJobVaS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/9zlt1ogkqty3cacssogf.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--WrJobVaS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/9zlt1ogkqty3cacssogf.png\" alt=\"script complete\" loading=\"lazy\" width=\"880\" height=\"292\"\/><\/a><\/p>\n<h5>\n  <a name=\"verifying-ssm-access-using-a-new-ec2-instance\" href=\"#verifying-ssm-access-using-a-new-ec2-instance\"><br \/>\n  <\/a><br \/>\n  Verifying ssm access using a new ec2 instance<br \/>\n<\/h5>\n<p>Lets launch a new instance using the free tier ami&#8217;s. The only difference from your regular choices are the ones that are captured here below. Please make sure that these are set right.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--2J22-Syw--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/vpf81v6vtzbm92gyvd4h.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--2J22-Syw--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/vpf81v6vtzbm92gyvd4h.png\" alt=\"vpc settings and role\" loading=\"lazy\" width=\"880\" height=\"400\"\/><\/a><br \/><em>here choose myVpc, the appA subnet and the new instance profile that was created<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--HtUksOyW--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ou2noraloue05lfxibvz.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--HtUksOyW--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ou2noraloue05lfxibvz.png\" alt=\"tag\" loading=\"lazy\" width=\"880\" height=\"384\"\/><\/a><br \/><em>give the instance a meaningful name<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--G-PcbCAP--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/hj307bfll5pst0jfieww.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--G-PcbCAP--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/hj307bfll5pst0jfieww.png\" alt=\"defaultSg\" loading=\"lazy\" width=\"880\" height=\"397\"\/><\/a><br \/><em>choose the default security group<\/em><\/p>\n<p>and finally launch the instance. Wait for it to go into a running state then connect to the ec2 instance.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vKrMCZw7--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/z83cq8puuz6nfdxydn4c.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vKrMCZw7--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/z83cq8puuz6nfdxydn4c.png\" alt=\"connect\" loading=\"lazy\" width=\"880\" height=\"742\"\/><\/a><br \/><em>click connect<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--9xB8cMox--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ct5utazcehj51lg8jddh.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--9xB8cMox--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ct5utazcehj51lg8jddh.png\" alt=\"session manager enabled\" loading=\"lazy\" width=\"880\" height=\"485\"\/><\/a><br \/><em>when session manager is enabled, the connect button is available to click<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--noaGgI0L--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/rapuhluw7cbajlcfn6ce.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--noaGgI0L--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/rapuhluw7cbajlcfn6ce.png\" alt=\"ssm\" loading=\"lazy\" width=\"880\" height=\"453\"\/><\/a><br \/><em>a successful yum update on the new private instance connected privately<\/em><\/p>\n<h5>\n  <a name=\"cleanup\" href=\"#cleanup\"><br \/>\n  <\/a><br \/>\n  Cleanup<br \/>\n<\/h5>\n<p>If you have not done it already, terminate your private instance and delete ssm stack so you don&#8217;t end paying for the endpoints while it&#8217;s not in use.<\/p>\n<h5>\n  <a name=\"2-testing-script-with-a-default-vpc-using-cloudformation-console\" href=\"#2-testing-script-with-a-default-vpc-using-cloudformation-console\"><br \/>\n  <\/a><br \/>\n  2. Testing script with a default VPC using CloudFormation Console<br \/>\n<\/h5>\n<p>Now, for ease to test with a different VPC I am going to use the default VPC. You may ask, are VPC endpoints needed because they are by default public. So I tested and found that a new instance that is created with just the role doesn&#8217;t enable the systems manager<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vYB0kG50--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/a8kwaa0b4y0x61xyju2c.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vYB0kG50--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/a8kwaa0b4y0x61xyju2c.png\" alt=\"unable to connect\" loading=\"lazy\" width=\"880\" height=\"683\"\/><\/a><br \/><em>a typical error message when it cant connect<\/em><\/p>\n<p>So, in order to test my script and adapt to the default VPC, I had to modify it slightly and comment out a line of code within the s3 gateway endpoint because default VPC&#8217;s only have 1 route entry.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>  S3GatewayEndpoint:\n    Type: AWS::EC2::VPCEndpoint\n    Properties:\n      ServiceName: !Sub 'com.amazonaws.${AWS::Region}.s3'\n      VpcEndpointType: Gateway\n      VpcId: !If [clientVpcExists, !Ref clientVpc, !ImportValue MyVpc]\n      RouteTableIds:\n        - !If [clientRouteTableAExists, !Ref clientRouteTableA, !ImportValue PrivateARouteTable]\n        # - !If [clientRouteTableBExists, !Ref clientRouteTableB, !ImportValue PrivateBRouteTable]\n      PolicyDocument:\n        Version: 2012-10-17\n        Statement:\n          - Effect: Allow\n            Principal: '*'\n            Action: '*'\n            Resource: '*'\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><em>notice the second line is commented out<\/em><\/p>\n<p>Now, if you launch the script and provide the client VPC id, 2 subnet id&#8217;s, and the private route table id for clientRouteTableA parameter, the script will successfully deploy.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--lVkqZxtG--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ottz7u4wgezp875877bo.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--lVkqZxtG--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ottz7u4wgezp875877bo.png\" alt=\"overrides\" loading=\"lazy\" width=\"880\" height=\"728\"\/><\/a><br \/><em>notice all values are overriden with default VPC values. all other options are same as the previous scenario to create the stack<\/em><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--igOd0pxh--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/uu2bbpmexpuf5kv6e6m9.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--igOd0pxh--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/uu2bbpmexpuf5kv6e6m9.png\" alt=\"tag\" loading=\"lazy\" width=\"880\" height=\"393\"\/><\/a><\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--UzwKaTVk--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/kxd3k2blqexpede8kft6.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--UzwKaTVk--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/kxd3k2blqexpede8kft6.png\" alt=\"default sg\" loading=\"lazy\" width=\"880\" height=\"402\"\/><\/a><\/p>\n<p>Once the instances are running you now see that you can connect to this public instance.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--ED4tSZco--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/zn0us2m4ksqf3qhp746m.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--ED4tSZco--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/zn0us2m4ksqf3qhp746m.png\" alt=\"ssm connect\" loading=\"lazy\" width=\"880\" height=\"485\"\/><\/a><\/p>\n<p><strong>Congratulations<\/strong> You just got Systems Manager enabled in your accounts.<\/p>\n<h5>\n  <a name=\"cleanup\" href=\"#cleanup\"><br \/>\n  <\/a><br \/>\n  Cleanup<br \/>\n<\/h5>\n<p>Just like the last time, cleanup after yourself by terminating your public instance and delete ssm stack so you don&#8217;t end paying for the endpoints while it&#8217;s not in use.<\/p>\n<h4>\n  <a name=\"resources\" href=\"#resources\"><br \/>\n  <\/a><br \/>\n  Resources<br \/>\n<\/h4>\n<p><strong>[about Lionel Pulickal]<\/strong><\/p>\n<p><em>Lionel is a Cloud Engineer who has worked in the IT industry since 1997. He has all the three AWS associate level exams, the solution architect professional and networking specialty exams under his belt. He loves hands-on and always loves to share the knowledge he has gained over the years.<\/em><\/p>\n<\/p><\/div>\n\n","protected":false},"excerpt":{"rendered":"<p>Systems Manager is a wonderful service and has many untapped features!! One common feature that has become popular in the recent past is connecting to Ec2 instances instead of using ssh. The setup guide for Systems Manager is very exhaustive and it\u2019s not very clear on what\u2019s the minimum that you require to enable it &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/connecting-to-private-ec2-instances-using-systems-manager-a-hands-on-guide\/\"> <span class=\"screen-reader-text\">Connecting to private Ec2 Instances using Systems Manager &#8211; A Hands-On Guide<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":1509,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1508"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=1508"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1508\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media\/1509"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=1508"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=1508"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=1508"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}