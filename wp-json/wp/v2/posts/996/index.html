{"id":996,"date":"2022-03-09T10:56:07","date_gmt":"2022-03-09T10:56:07","guid":{"rendered":"http:\/\/localhost\/wordpress\/using-distzilla-to-create-a-new-cpan-module\/"},"modified":"2022-03-09T10:56:07","modified_gmt":"2022-03-09T10:56:07","slug":"using-distzilla-to-create-a-new-cpan-module","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/using-distzilla-to-create-a-new-cpan-module\/","title":{"rendered":"Using Dist::Zilla to create a new CPAN module"},"content":{"rendered":"<p> <br \/>\n<\/p>\n<div data-article-id=\"1011459\" id=\"article-body\">\n<p>Recently, I posted about some tools that are perhaps not as well known as they should be. I asked on Twitter (from @perlkiwi) for suggetsions and one was distzilla.<\/p>\n<p>I didn&#8217;t include it at the time in part because I knew I wanted to mint a new CPAN module and planned on using distzilla to do it, so this tale is going to cover how it works and how it helped me put a module together.<\/p>\n<h2>\n  <a name=\"what-is-distzilla\" href=\"#what-is-distzilla\"><br \/>\n  <\/a><br \/>\n  What is Dist::Zilla<br \/>\n<\/h2>\n<p>Dist::Zilla (aka distzilla aka dzil) is a command line tool to help you create and perhaps more importantly maintain packages you intend to share via CPAN.<\/p>\n<p>It really does help ensure you create a good package and make it easy to maintain that module over time. Perl people know the importance of maintaining legacy code; so dzil is really valuable.<\/p>\n<h2>\n  <a name=\"getting-started\" href=\"#getting-started\"><br \/>\n  <\/a><br \/>\n  Getting started<br \/>\n<\/h2>\n<p>If you have never tried distzilla, then do pop over to the main website <a href=\"https:\/\/dzil.org\/\">dzil.org<\/a> which has a fabulous &#8220;Choose your own adventure&#8221; way of introducing you to the tool. I really like the site and LOVE a different approach to doing documentation.<\/p>\n<p>In short&#8230; you start by typing something like <code>dzil new WebService::SmartRow<\/code>, which will create a new directory for you with a dist.ini a base lib\/WebService\/SmartRow.pm file and a few other bits and pieces.<\/p>\n<p>From here, I started a new repo on github and added the &#8220;remote&#8221; to the created directory (<code>git init<\/code> then <code>git remote add origin git@github.com:lancew\/WebService-SmartRow.git<\/code>) after which I could happily <code>git add .<\/code> then commit and push the changes.<\/p>\n<h2>\n  <a name=\"writing-the-code\" href=\"#writing-the-code\"><br \/>\n  <\/a><br \/>\n  Writing the code<br \/>\n<\/h2>\n<p>The module I was writing is a small wrapper around a JSON API endpoint from <a href=\"https:\/\/smartrow.fit\/\">https:\/\/smartrow.fit\/<\/a>. I just wanted to be able to access the workout data so I could munge the data in a few different ways and create some charts for myself.<\/p>\n<p>The module itself is pretty simple. I used <code>Moo<\/code> out of habit and <code>HTTP::Tiny<\/code> for the network part and <code>Cpanel::JSON::XS<\/code> for the JSON handling.<\/p>\n<p>These are specified in the <code>dist.ini<\/code> file as prerequisites:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>[Prereqs]\nperl = v5.06.0 ;\nCpanel::JSON::XS = 4.27 ;\nHTTP::Tiny = 0.080 ;\nMoo = 2.005004 ;\nnamespace::clean = 0.27 ;\n\n[Prereqs \/ TestRequires]\nTest2::V0 = 0.000145 ;\n\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can see I have two sets of dependencies, one for the app itself and one for testing dependencies for installation. I use Test2::V0 so I pop it in there.<\/p>\n<h2>\n  <a name=\"uploading-to-cpan\" href=\"#uploading-to-cpan\"><br \/>\n  <\/a><br \/>\n  Uploading to CPAN<br \/>\n<\/h2>\n<p>After having written the code and tests I wanted to upload to CPAN, this I can do with distzilla via the helpful <code>dzil release --trial<\/code> command; which as I have already used dzil to upload modules before worked forst time. \ud83d\ude42<\/p>\n<p>All you need to know is you <a href=\"https:\/\/pause.cpan.org\">pause<\/a> credentials.<\/p>\n<h2>\n  <a name=\"distzilla-plugins-for-the-win\" href=\"#distzilla-plugins-for-the-win\"><br \/>\n  <\/a><br \/>\n  Dist::Zilla plugins for the win!<br \/>\n<\/h2>\n<p>Having uploaded the package as trial, it was a good time to use distzilla to fine tune my module. This is super easy via the large array of plugins (and plugin bundles). The biggest problem is choosing them and dealing with the odd conflict.<\/p>\n<p>A good one to start with is <a href=\"https:\/\/metacpan.org\/pod\/Dist::Zilla::PluginBundle::TestingMania\">@TestingMania<\/a> bundle includes a lot of really helpful tetsing tools. PerlTidy, PerlCritic, PodCoverage and more intricate ones to test your META info. WHich is important if the package is going to CPAN.<\/p>\n<p>Add the bundle is easy, just add [@TestingMania] into your <code>dist.ini<\/code> and run <code>dzil test<\/code>. If the dependencies you need are not there distzilla will prompt you with the command you need which is <code>dzil authordeps --missing | cpanm<\/code>.<\/p>\n<h2>\n  <a name=\"git-and-github-integration\" href=\"#git-and-github-integration\"><br \/>\n  <\/a><br \/>\n  Git and GitHub integration<br \/>\n<\/h2>\n<p>I am using GitHub to host the code for this module, so I added a few plugins:<\/p>\n<h3>\n  <a name=\"githubmeta\" href=\"#githubmeta\"><br \/>\n  <\/a><br \/>\n  GitHub::Meta<br \/>\n<\/h3>\n<p>This plugin includes things like the repository url and issue tracker in the META for the package.<\/p>\n<p>By inlcuding the plugin (and META infor), metacpan will know that the repo is on GitHub and present it in the UI. It also tells metacpan that I am using the issue tracker on GitHub and this prevents it from defaulting to RT.<\/p>\n<h3>\n  <a name=\"git\" href=\"#git\"><br \/>\n  <\/a><br \/>\n  <a class=\"mentioned-user\" href=\"https:\/\/dev.to\/git\">@git<\/a><br \/>\n<\/h3>\n<p>The <a href=\"https:\/\/metacpan.org\/pod\/Dist::Zilla::PluginBundle::Git\">@Git<\/a> bundle is helpful for ensuring a few Git related things are done correctly. I.e. that the repo is &#8220;clean&#8221; before you release. It also does a git tag automatically on release and pushes it to GitHub for me automatically.<\/p>\n<p>This bundle did push me to update my <code>.gitignore<\/code> file to ignore the <code>WebService-SmartRow-*<\/code> files and directory that Dist::Zilla builds.<\/p>\n<h3>\n  <a name=\"gitnextversion\" href=\"#gitnextversion\"><br \/>\n  <\/a><br \/>\n  Git::NextVersion<br \/>\n<\/h3>\n<p>The last of the Git plugins is my favourite, thos one automatically bumps the version when I do a release which meant I could remove the <code>version = 0.001<\/code> from the dist.ini as the plugin increments based on the tags in the repo. It&#8217;s cool, I like it.<\/p>\n<h2>\n  <a name=\"changes\" href=\"#changes\"><br \/>\n  <\/a><br \/>\n  Changes<br \/>\n<\/h2>\n<p>I am terrible at updating teh Changes file in repositories, so I added these two plugins:<\/p>\n<h3>\n  <a name=\"testchangeshascontent\" href=\"#testchangeshascontent\"><br \/>\n  <\/a><br \/>\n  Test::ChangesHasContent<br \/>\n<\/h3>\n<p>This plugin creates a <code>.t<\/code> file that confirms you have content in the Changes file matching the next release.<\/p>\n<h3>\n  <a name=\"checkchangeshascontent\" href=\"#checkchangeshascontent\"><br \/>\n  <\/a><br \/>\n  CheckChangesHasContent<br \/>\n<\/h3>\n<p>This plugin is similar, in that it actually prevents you from releasing if you have not got content for the new release in the changes file.<\/p>\n<p>I use both, as I like the warning early via <code>dzil test<\/code> that the first plugin gives me and the second is there mainly in case I ever removethe first I suppose. Maybe I could should delete it?<\/p>\n<h2>\n  <a name=\"the-bundles-gotcha\" href=\"#the-bundles-gotcha\"><br \/>\n  <\/a><br \/>\n  The Bundles gotcha<br \/>\n<\/h2>\n<p>The plugin bundles are awesome, with one exception for new dzil users. They can cause conflicts where the same plugin is referenced twice. This is not too scary once you have seen it a couple of times; but can be a stress when it hits you the first time. Just read the message and try and understand which two bundles are conflicting. You can (at least I could in @TestingMania) disable a plugin and that can solve the issue for you (I just added <code>disable = Test::Version ;<\/code> for example immediately after the <code>[@TestingMania]<\/code> in dist.ini; YMMV).<\/p>\n<h2>\n  <a name=\"dzil-as-tool\" href=\"#dzil-as-tool\"><br \/>\n  <\/a><br \/>\n  dzil as tool.<br \/>\n<\/h2>\n<p>dzil is really helpful. <code>dzil test<\/code> and <code>dzil test --release<\/code> ensures my module is in a pretty good state.<\/p>\n<p><code>dzil build<\/code> (and <code>dzil clean<\/code>) are handy for building the module so I can look at what will end up on CPAN.<\/p>\n<p><code>dzil install<\/code> installs the module like a normal cpan module; so I could use the module in a script elsewhere on my machine as if I had downloaded it from CPAN. Given this module is mainly about accessing a JSON API; this is a helpful feature to save uploading to cpan and then installing from cpan more than I need to.<\/p>\n<h2>\n  <a name=\"summary\" href=\"#summary\"><br \/>\n  <\/a><br \/>\n  Summary<br \/>\n<\/h2>\n<p>Dist::Zilla can be a little overwhelming, but I find it pretty intuitive if you take small steps. I added each plugin one at a time as that helps keep the confusion to a minimum. Bundles are great; but can have conflicts. It is by it&#8217;s own definition &#8220;maximum overkill&#8221;; but it&#8217;s easy overkill so give it a try.<\/p>\n<p>Let me know how you get on.<\/p>\n<p>Tags: <a href=\"http:\/\/perl.kiwi\/tales\/tag\/distzilla\/\">distzilla<\/a><a href=\"http:\/\/perl.kiwi\/tales\/tag\/cpan\/\">cpan<\/a><a href=\"http:\/\/perl.kiwi\/tales\/tag\/cpants\/\">cpants<\/a><a href=\"http:\/\/perl.kiwi\/tales\/tag\/kwalitee\/\">kwalitee<\/a><\/p>\n<\/p><\/div>\n\n","protected":false},"excerpt":{"rendered":"<p>Recently, I posted about some tools that are perhaps not as well known as they should be. I asked on Twitter (from @perlkiwi) for suggetsions and one was distzilla. I didn&#8217;t include it at the time in part because I knew I wanted to mint a new CPAN module and planned on using distzilla to &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/using-distzilla-to-create-a-new-cpan-module\/\"> <span class=\"screen-reader-text\">Using Dist::Zilla to create a new CPAN module<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":997,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/996"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=996"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/996\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media\/997"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=996"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=996"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=996"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}