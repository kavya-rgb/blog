{"id":1021,"date":"2022-03-09T11:18:56","date_gmt":"2022-03-09T11:18:56","guid":{"rendered":"http:\/\/localhost\/wordpress\/deploy-jhipster-microservices-to-gcp-with-kubernetes\/"},"modified":"2022-03-09T11:18:56","modified_gmt":"2022-03-09T11:18:56","slug":"deploy-jhipster-microservices-to-gcp-with-kubernetes","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/deploy-jhipster-microservices-to-gcp-with-kubernetes\/","title":{"rendered":"Deploy JHipster Microservices to GCP with Kubernetes"},"content":{"rendered":"<p> <br \/>\n<\/p>\n<div data-article-id=\"1016751\" id=\"article-body\">\n<p>When your business or application is successful, it needs to scale. Not just technology-wise, but human-wise. When you&#8217;re growing rapidly, it can be difficult to hire developers fast enough. Using a microservices architecture for your apps can allow you to divide up ownership and responsibilities, and scale teams along with your code.<\/p>\n<p>Kubernetes is an open-source platform for managing containerized workloads and services. Kubernetes traces its lineage <a href=\"https:\/\/kubernetes.io\/blog\/2015\/04\/borg-predecessor-to-kubernetes\/\">directly from Borg<\/a>, Google&#8217;s long-rumored internal container-oriented cluster-management system.<\/p>\n<p>Spring Boot and Spring Cloud were some of the pioneering frameworks in Javaland. However, even they stood on the shoulders of giants when they leveraged Netflix&#8217;s open-source projects to embrace and extend. In 2018, <a href=\"https:\/\/netflixtechblog.com\/netflix-oss-and-spring-boot-coming-full-circle-4855947713a0\">Netflix OSS announced they&#8217;d come full circle<\/a>, and adopted Spring Boot.<\/p>\n<p>Today, I&#8217;d like to show you how to build and deploy (with Kubernetes) a <strong>reactive<\/strong> microservice architecture with Spring Boot, Spring Cloud, and JHipster. Why reactive? Because Spring Cloud Gateway is now the default for JHipster 7 gateways, even if you choose to build your microservices with Spring MVC.<\/p>\n<p>Spring Cloud Gateway is a library for building an API Gateway on top of Spring WebFlux. It easily integrates with OAuth to communicate between microservices. You just need to add a <code>TokenRelay<\/code> filter.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">spring<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">cloud<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">gateway<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">default-filters<\/span><span class=\"pi\">:<\/span>\n        <span class=\"pi\">-<\/span> <span class=\"s\">TokenRelay<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><strong>CAUTION<\/strong>: Spring Cloud no longer supports Netflix Zuul. An <a href=\"https:\/\/github.com\/spring-cloud\/spring-cloud-gateway\/issues\/36\">open issue<\/a> adds Spring MVC\/Servlet support to Spring Cloud Gateway. It&#8217;s scheduled for implementation before the end of 2021.<\/p>\n<p><strong>Prerequisites<\/strong>:<\/p>\n<p>You can also <a href=\"https:\/\/youtu.be\/SQFl7ggNYIE\">watch this tutorial as a screencast<\/a>.<\/p>\n<p><div class=\"ast-oembed-container\"><iframe loading=\"lazy\" title=\"Kubernetes to the Cloud with Spring Boot and JHipster\" width=\"500\" height=\"281\" src=\"https:\/\/www.youtube.com\/embed\/SQFl7ggNYIE?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen><\/iframe><\/div>\n<p><\/iframe>\n<\/p>\n<h2>\n  <a name=\"a-brief-intro-to-kubernetes-k8s\" href=\"#a-brief-intro-to-kubernetes-k8s\"><br \/>\n  <\/a><br \/>\n  A Brief Intro to Kubernetes (K8s)<br \/>\n<\/h2>\n<p>Kubernetes is an open-source project from Google that provides an API for deploying your apps and making them talk with each other. It helps automate deployments and updates, and manages your apps and services with limited downtime. You use Docker containers and YAML to make it all work.<\/p>\n<p>The YAML can be burdensome, but that&#8217;s where JHipster comes in. It can generate the YAML for you!<\/p>\n<h2>\n  <a name=\"create-a-kubernetesready-microservices-architecture\" href=\"#create-a-kubernetesready-microservices-architecture\"><br \/>\n  <\/a><br \/>\n  Create a Kubernetes-Ready Microservices Architecture<br \/>\n<\/h2>\n<p>I showed you how to build <a href=\"https:\/\/developer.okta.com\/blog\/2021\/01\/20\/reactive-java-microservices\">Reactive Java microservices with Spring Boot and JHipster<\/a> in a previous post. Today, I&#8217;ll show you how to generate K8s deployment descriptors, use Spring Cloud Config with Git, encrypt your secrets, and make it all work on Google Cloud (<a href=\"https:\/\/cloud.google.com\/kubernetes-engine\/\">GKE<\/a> to be specific).<\/p>\n<p>Start by cloning the JHipster 7 { Vue, Spring Boot, WebFlux } reactive microservices project from GitHub:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>git clone https:\/\/github.com\/oktadev\/java-microservices-examples.git\n<span class=\"nb\">cd <\/span>java-microservices-examples\/reactive-jhipster\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<blockquote>\n<p><strong>TIP<\/strong>: If you just want to see the completed project, just cd into the project&#8217;s <code>jhipster-k8s<\/code> directory.<\/p>\n<pre class=\"highlight plaintext\"><code>cd ..\/jhipster-k8s\n<\/code><\/pre>\n<\/blockquote>\n<p>This project has four directories:<\/p>\n<ol>\n<li>\n<code>gateway<\/code>: a Spring Boot + Spring Cloud Gateway project configured for OpenID Connect (OIDC) login. It&#8217;s also configured as an OAuth 2.0 resource server. It contains a front-end application built with Vue.<\/li>\n<li>\n<code>blog<\/code>: a Spring Boot + WebFlux microservice that talks to a Neo4j database.<\/li>\n<li>\n<code>store<\/code>: a Spring Boot + WebFlux microservice that uses MongoDB.<\/li>\n<li>\n<code>docker-compose<\/code>: a set of Docker files that describe how to run all containers together.<\/li>\n<\/ol>\n<p><strong>NOTE<\/strong>: The SPA app on the gateway is currently a monolith. The JHipster team is still working on <a href=\"https:\/\/github.com\/jhipster\/generator-jhipster\/issues\/10189\">micro frontends support<\/a>.<\/p>\n<p>If you don&#8217;t have JHipster installed, install it.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>npm i <span class=\"nt\">-g<\/span> generator-jhipster@7\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<h2>\n  <a name=\"generate-kubernetes-deployment-descriptors\" href=\"#generate-kubernetes-deployment-descriptors\"><br \/>\n  <\/a><br \/>\n  Generate Kubernetes Deployment Descriptors<br \/>\n<\/h2>\n<p>Navigate to the <code>reactive-jhipster<\/code> directory. Next, create a <code>k8s<\/code> directory, cd into it, and run JHipster&#8217;s <a href=\"https:\/\/www.jhipster.tech\/kubernetes\/\">Kubernetes sub-generator<\/a>.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">mkdir <\/span>k8s\n<span class=\"nb\">cd <\/span>k8s\njhipster k8s\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You&#8217;ll be prompted with several questions. Answer them as I did below:<\/p>\n<ul>\n<li>Type of application: <strong>Microservice application<\/strong>\n<\/li>\n<li>Root directory: <strong>..\/<\/strong>\n<\/li>\n<li>Which applications? <code>&lt;select all&gt;<\/code>\n<\/li>\n<li>Set up monitoring? <strong>No<\/strong>\n<\/li>\n<li>Which applications with clustered databases? select <strong>store<\/strong>\n<\/li>\n<li>Admin password for JHipster Registry: <\/li>\n<li>Kubernetes namespace: <strong>demo<\/strong>\n<\/li>\n<li>Docker repository name: <\/li>\n<li>Command to push Docker image: <code>docker push<\/code>\n<\/li>\n<li>Enable Istio? <strong>No<\/strong>\n<\/li>\n<li>Kubernetes service type? <strong>LoadBalancer<\/strong>\n<\/li>\n<li>Use dynamic storage provisioning? <strong>Yes<\/strong>\n<\/li>\n<li>Use a specific storage class? <code>&lt;leave empty&gt;<\/code>\n<\/li>\n<\/ul>\n<p><strong>NOTE<\/strong>: If you don&#8217;t want to publish your images on <a href=\"https:\/\/hub.docker.com\/\">Docker Hub<\/a>, leave the Docker repository name blank.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--fUuMwN_g--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/0jasoqzaor8irqgr68qo.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--fUuMwN_g--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/0jasoqzaor8irqgr68qo.png\" alt=\"JHipster K8s command with answers\" loading=\"lazy\" width=\"880\" height=\"552\"\/><\/a><\/p>\n<p>After I answered these questions, my <code>k8s\/.yo-rc.json<\/code> file had the following contents:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight json\"><code><span class=\"p\">{<\/span><span class=\"w\">\n  <\/span><span class=\"nl\">\"generator-jhipster\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"p\">{<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"appsFolders\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"p\">[<\/span><span class=\"s2\">\"blog\"<\/span><span class=\"p\">,<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"gateway\"<\/span><span class=\"p\">,<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"store\"<\/span><span class=\"p\">],<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"directoryPath\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"..\/\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"clusteredDbApps\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"p\">[<\/span><span class=\"s2\">\"store\"<\/span><span class=\"p\">],<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"serviceDiscoveryType\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"eureka\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"jwtSecretKey\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"NDFhMGY4NjF...\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"dockerRepositoryName\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"mraible\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"dockerPushCommand\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"docker push\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"kubernetesNamespace\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"demo\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"kubernetesServiceType\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"LoadBalancer\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"kubernetesUseDynamicStorage\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"kc\">true<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"kubernetesStorageClassName\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"ingressDomain\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"monitoring\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"s2\">\"no\"<\/span><span class=\"p\">,<\/span><span class=\"w\">\n    <\/span><span class=\"nl\">\"istio\"<\/span><span class=\"p\">:<\/span><span class=\"w\"> <\/span><span class=\"kc\">false<\/span><span class=\"w\">\n  <\/span><span class=\"p\">}<\/span><span class=\"w\">\n<\/span><span class=\"p\">}<\/span><span class=\"w\">\n<\/span><\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>I already showed you how to get everything working with Docker Compose <a href=\"https:\/\/developer.okta.com\/blog\/2021\/01\/20\/reactive-java-microservices#run-your-microservices-stack-with-docker-compose\">in the previous tutorial<\/a>. So today, I&#8217;d like to show you how to run things locally with <a href=\"https:\/\/minikube.sigs.k8s.io\/docs\/\">Minikube<\/a>.<\/p>\n<h2>\n  <a name=\"install-minikube-to-run-kubernetes-locally\" href=\"#install-minikube-to-run-kubernetes-locally\"><br \/>\n  <\/a><br \/>\n  Install Minikube to Run Kubernetes Locally<br \/>\n<\/h2>\n<p>If you have Docker installed, you can run Kubernetes locally with Minikube. Run <code>minikube start<\/code> to begin.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>minikube <span class=\"nt\">--cpus<\/span> 8 start\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><strong>CAUTION<\/strong>: If this doesn&#8217;t work, use <code>brew install minikube<\/code>, or see <a href=\"https:\/\/minikube.sigs.k8s.io\/docs\/start\/\">Minikube&#8217;s installation instructions<\/a>.<\/p>\n<p>This command will start Minikube with 16 GB of RAM and 8 CPUs. Unfortunately, the default, which is 16 GB RAM and two CPUs, did not work for me.<\/p>\n<p><em>You can skip ahead to creating your Docker images while you wait for this to complete.<\/em><\/p>\n<p>After this command executes, it&#8217;ll print out a message and notify you which cluster and namespace are being used.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>\ud83c\udfc4  Done! kubectl is now configured to use <span class=\"s2\">\"minikube\"<\/span> cluster and <span class=\"s2\">\"default\"<\/span> namespace by default\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><strong>TIP<\/strong>: You can stop Minikube with <code>minikube stop<\/code> and start over with <code>minikube delete<\/code>.<\/p>\n<h2>\n  <a name=\"create-docker-images-with-jib\" href=\"#create-docker-images-with-jib\"><br \/>\n  <\/a><br \/>\n  Create Docker Images with Jib<br \/>\n<\/h2>\n<p>Now, you need to build Docker images for each app. In the { <code>gateway<\/code>, <code>blog<\/code>, <code>store<\/code> } directories, run the following Gradle command (where <code>&lt;image-name&gt;<\/code> is <code>gateway<\/code>, <code>store<\/code>, or <code>blog<\/code>).<\/p>\n<p>This command should also be in the window where you ran <code>jhipster k8s<\/code>, so you can copy them from there.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/gradlew bootJar <span class=\"nt\">-Pprod<\/span> jib <span class=\"nt\">-Djib<\/span>.to.image<span class=\"o\">=<\/span>&lt;docker-repo-name&gt;\/&lt;image-name&gt;\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<h3>\n  <a name=\"create-private-docker-images\" href=\"#create-private-docker-images\"><br \/>\n  <\/a><br \/>\n  Create Private Docker Images<br \/>\n<\/h3>\n<p>You can also build your images locally and publish them to your Docker daemon. This is the default if you didn&#8217;t specify a base Docker repository name.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"c\"># this command exposes Docker images to minikube<\/span>\n<span class=\"nb\">eval<\/span> <span class=\"si\">$(<\/span>minikube docker-env<span class=\"si\">)<\/span>\n.\/gradlew <span class=\"nt\">-Pprod<\/span> bootJar jibDockerBuild\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Because this publishes your images locally to Docker, you&#8217;ll need to make modifications to your Kubernetes deployment files to use <code>imagePullPolicy: IfNotPresent<\/code>.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway-app<\/span>\n  <span class=\"na\">image<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway<\/span>\n  <span class=\"na\">imagePullPolicy<\/span><span class=\"pi\">:<\/span> <span class=\"s\">IfNotPresent<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Make sure to add this <code>imagePullPolicy<\/code> to the following files:<\/p>\n<ul>\n<li><code>k8s\/gateway-k8s\/gateway-deployment.yml<\/code><\/li>\n<li><code>k8s\/blog-k8s\/blog-deployment.yml<\/code><\/li>\n<li><code>k8s\/store-k8s\/store-deployment.yml<\/code><\/li>\n<\/ul>\n<h2>\n  <a name=\"register-an-oidc-app-for-auth\" href=\"#register-an-oidc-app-for-auth\"><br \/>\n  <\/a><br \/>\n  Register an OIDC App for Auth<br \/>\n<\/h2>\n<p>You&#8217;ve now built Docker images for your microservices, but you haven&#8217;t seen them running. First, you&#8217;ll need to configure Okta for authentication and authorization.<\/p>\n<p>Before you begin, you\u2019ll need a free Okta developer account. Install the <a href=\"https:\/\/cli.okta.com\/\">Okta CLI<\/a> and run <code>okta register<\/code> to sign up for a new account. If you already have an account, run <code>okta login<\/code>. Then, run <code>okta apps create jhipster<\/code>. Select the default app name, or change it as you see fit. Accept the default Redirect URI values provided for you.<\/p>\n<p>JHipster ships with <a href=\"https:\/\/www.jhipster.tech\/jhipster-registry\/\">JHipster Registry<\/a>. It acts as a Eureka service for service discovery and contains a Spring Cloud Config server for distributing your configuration settings.<\/p>\n<p>Update <code>k8s\/registry-k8s\/application-configmap.yml<\/code> to contain your OIDC settings from the <code>.okta.env<\/code> file the Okta CLI just created. The Spring Cloud Config server reads from this file and shares the values with the gateway and microservices.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">data<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">application.yml<\/span><span class=\"pi\">:<\/span> <span class=\"pi\">|-<\/span>\n    <span class=\"s\">...<\/span>\n    <span class=\"s\">spring:<\/span>\n      <span class=\"s\">security:<\/span>\n        <span class=\"s\">oauth2:<\/span>\n          <span class=\"s\">client:<\/span>\n            <span class=\"s\">provider:<\/span>\n              <span class=\"s\">oidc:<\/span>\n                <span class=\"s\">issuer-uri: https:\/\/&lt;your-okta-domain&gt;\/oauth2\/default<\/span>\n            <span class=\"s\">registration:<\/span>\n              <span class=\"s\">oidc:<\/span>\n                <span class=\"s\">client-id: &lt;client-id&gt;<\/span>\n                <span class=\"s\">client-secret: &lt;client-secret&gt;<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>To configure the JHipster Registry to use OIDC for authentication, modify <code>k8s\/registry-k8s\/jhipster-registry.yml<\/code> to enable the <code>oauth2<\/code> profile.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_PROFILES_ACTIVE<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">prod,k8s,oauth2<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Now that you&#8217;ve configured everything, it&#8217;s time to see it in action.<\/p>\n<h2>\n  <a name=\"start-your-spring-boot-microservices-with-k8s\" href=\"#start-your-spring-boot-microservices-with-k8s\"><br \/>\n  <\/a><br \/>\n  Start Your Spring Boot Microservices with K8s<br \/>\n<\/h2>\n<p>In the <code>k8s<\/code> directory, start your engines!<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/kubectl-apply.sh <span class=\"nt\">-f<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can see if everything starts up using the following command.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl get pods <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can use the name of a pod with <code>kubectl logs<\/code> to tail its logs.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl logs &lt;pod-name&gt; <span class=\"nt\">--tail<\/span><span class=\"o\">=<\/span><span class=\"nt\">-1<\/span> <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can use port-forwarding to see the JHipster Registry.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl port-forward svc\/jhipster-registry <span class=\"nt\">-n<\/span> demo 8761\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Open a browser and navigate to <code>http:\/\/localhost:8761<\/code>. You&#8217;ll need to sign in with your Okta credentials.<\/p>\n<p>Once all is green, use port-forwarding to see the gateway app.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl port-forward svc\/gateway <span class=\"nt\">-n<\/span> demo 8080\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Then, go to <code>http:\/\/localhost:8080<\/code>, and you should be able to add blogs, posts, tags, and products.<\/p>\n<p>You can also automate testing to ensure that everything works. Set your Okta credentials as environment variables and run end-to-end tests using Cypress (from the gateway directory).<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">export <\/span><span class=\"nv\">CYPRESS_E2E_USERNAME<\/span><span class=\"o\">=<\/span>&lt;your-username&gt;\n<span class=\"nb\">export <\/span><span class=\"nv\">CYPRESS_E2E_PASSWORD<\/span><span class=\"o\">=<\/span>&lt;your-password&gt;\nnpm run e2e\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Proof it worked for me:<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--_3DHfRX---\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/20zw0ja1741d6qdbls1f.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--_3DHfRX---\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/20zw0ja1741d6qdbls1f.png\" alt=\"Cypress end-to-end tests\" loading=\"lazy\" width=\"880\" height=\"377\"\/><\/a><\/p>\n<h3>\n  <a name=\"plain-text-secrets-uggh\" href=\"#plain-text-secrets-uggh\"><br \/>\n  <\/a><br \/>\n  Plain Text Secrets? Uggh!<br \/>\n<\/h3>\n<p>You may notice that I used a secret in plain text in the <code>application-configmap.yml<\/code> file. Secrets in plain text are a bad practice! I hope you didn&#8217;t check everything into source control yet!!<\/p>\n<h2>\n  <a name=\"encrypt-your-secrets-with-spring-cloud-config\" href=\"#encrypt-your-secrets-with-spring-cloud-config\"><br \/>\n  <\/a><br \/>\n  Encrypt Your Secrets with Spring Cloud Config<br \/>\n<\/h2>\n<p>The JHipster Registry has an encryption mechanism you can use to encrypt your secrets. That way, it&#8217;s safe to store them in public repositories.<\/p>\n<p>Add an <code>ENCRYPT_KEY<\/code> to the environment variables in <code>k8s\/registry-k8s\/jhipster-registry.yml<\/code>.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ENCRYPT_KEY<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">really-long-string-of-random-charters-that-you-can-keep-safe<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<blockquote>\n<p><strong>TIP<\/strong>: You can use JShell to generate a UUID you can use for your encrypt key.<\/p>\n<pre class=\"highlight shell\"><code>jshell\n\nUUID.randomUUID<span class=\"o\">()<\/span>\n<\/code><\/pre>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--EqkzLp9D--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/a0965zjdmnqfw64bq7x4.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--EqkzLp9D--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/a0965zjdmnqfw64bq7x4.png\" alt=\"JShell UUID\" loading=\"lazy\" width=\"880\" height=\"264\"\/><\/a><\/p>\n<p>You can quit by typing <code>\/exit<\/code>.<\/p>\n<\/blockquote>\n<p>Restart your JHipster Registry containers from the <code>k8s<\/code> directory.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/kubectl-apply.sh <span class=\"nt\">-f<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<h3>\n  <a name=\"encrypt-your-oidc-client-secret\" href=\"#encrypt-your-oidc-client-secret\"><br \/>\n  <\/a><br \/>\n  Encrypt Your OIDC Client Secret<br \/>\n<\/h3>\n<p>You can encrypt your client secret by logging into <code>http:\/\/localhost:8761<\/code> and going to <strong>Configuration<\/strong> &gt; <strong>Encryption<\/strong>. If this address doesn&#8217;t resolve, you&#8217;ll need to port-forward again.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl port-forward svc\/jhipster-registry <span class=\"nt\">-n<\/span> demo 8761\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Copy and paste your client secret from <code>application-configmap.yml<\/code> (or <code>.okta.env<\/code>) and click <strong>Encrypt<\/strong>.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--QT-n59Hk--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/b01ymbgzi7igaxpt6k9g.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--QT-n59Hk--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/b01ymbgzi7igaxpt6k9g.png\" alt=\"JHipster Registry Encrypt Feature\" loading=\"lazy\" width=\"880\" height=\"381\"\/><\/a><\/p>\n<p>Then, copy the encrypted value back into <code>application-configmap.yml<\/code>. Make sure to wrap it in quotes!<\/p>\n<p>You can also use curl:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>curl <span class=\"nt\">-X<\/span> POST http:\/\/admin:&lt;password-you-set-earlier&gt;@localhost:8761\/config\/encrypt <span class=\"nt\">-d<\/span> your-client-secret\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>If you use curl, make sure to add <code>{cipher}<\/code> to the beginning of the string. For example:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">client-secret<\/span><span class=\"pi\">:<\/span> <span class=\"s2\">\"<\/span><span class=\"s\">{cipher}1b12934716c32d360c85f651a0793df2777090c...\"<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Apply these changes and restart all deployments.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/kubectl-apply.sh <span class=\"nt\">-f<\/span>\nkubectl rollout restart deploy <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Verify everything still works at <code>http:\/\/localhost:8080<\/code>.<\/p>\n<p><strong>TIP<\/strong>: If you don&#8217;t want to restart the Spring Cloud Config server when you update its configuration, see <a href=\"https:\/\/developer.okta.com\/blog\/2020\/12\/07\/spring-cloud-config#refresh-the-configuration-in-your-spring-cloud-config-server\">Refresh the Configuration in Your Spring Cloud Config Server<\/a>.<\/p>\n<h3>\n  <a name=\"change-spring-cloud-config-to-use-git\" href=\"#change-spring-cloud-config-to-use-git\"><br \/>\n  <\/a><br \/>\n  Change Spring Cloud Config to use Git<br \/>\n<\/h3>\n<p>You might want to store your app&#8217;s configuration externally. That way, you don&#8217;t have to redeploy everything to change values. Good news! Spring Cloud Config makes it easy to switch to Git instead of the filesystem to store your configuration.<\/p>\n<p>In <code>k8s\/registry-k8s\/jhipster-registry.yml<\/code>, find the following variables:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_0_TYPE<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">native<\/span>\n<span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_0_SEARCH_LOCATIONS<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">file:.\/central-config<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Below these values, add a second lookup location.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_1_TYPE<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">git<\/span>\n<span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_1_URI<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">https:\/\/github.com\/mraible\/reactive-java-ms-config\/<\/span>\n<span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_1_SEARCH_PATHS<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">config<\/span>\n<span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">SPRING_CLOUD_CONFIG_SERVER_COMPOSITE_1_LABEL<\/span>\n  <span class=\"na\">value<\/span><span class=\"pi\">:<\/span> <span class=\"s\">main<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Create a GitHub repo that matches the URI, path, and branch you entered.<\/p>\n<p>In my case, I created <a href=\"https:\/\/github.com\/mraible\/reactive-java-ms-config\/\">reactive-java-ms-config<\/a> and added a <code>config\/application.yml<\/code> file in the <code>main<\/code> branch. Then, I added my <code>spring.security.*<\/code> values to it and removed them from <code>k8s\/registry-k8s\/application-configmap.yml<\/code>.<\/p>\n<p>See Spring Cloud Config&#8217;s <a href=\"https:\/\/cloud.spring.io\/spring-cloud-config\/multi\/multi__spring_cloud_config_server.html#_git_backend\">Git Backend docs<\/a> for more information.<\/p>\n<h2>\n  <a name=\"deploy-spring-boot-microservices-to-google-cloud-aka-gcp\" href=\"#deploy-spring-boot-microservices-to-google-cloud-aka-gcp\"><br \/>\n  <\/a><br \/>\n  Deploy Spring Boot Microservices to Google Cloud (aka GCP)<br \/>\n<\/h2>\n<p>It&#8217;s nice to see things running locally on your machine, but it&#8217;s even better to get to production! In this section, I&#8217;ll show you how to deploy your containers to Google Cloud.<\/p>\n<p>First, stop Minikube if you were running it previously.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>minikube stop\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can also use <code>kubectl<\/code> commands to switch clusters.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl config get-contexts\nkubectl config use-context XXX\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>The cool kids use <code>kubectx<\/code> and <code>kubens<\/code> to set the default context and namespace. You can learn how to install and use them via the <a href=\"https:\/\/github.com\/ahmetb\/kubectx\">kubectx GitHub project<\/a>.<\/p>\n<h3>\n  <a name=\"create-a-container-registry-on-google-cloud\" href=\"#create-a-container-registry-on-google-cloud\"><br \/>\n  <\/a><br \/>\n  Create a Container Registry on Google Cloud<br \/>\n<\/h3>\n<p>Before the JHipster 7.0.0 release, I tested this microservice example with Kubernetes and Google Cloud. I found many solutions in Ray Tsang&#8217;s <a href=\"https:\/\/spring-gcp.saturnism.me\/\">Spring Boot on GCP Guides<\/a>. <a href=\"https:\/\/twitter.com\/mraible\/status\/1372964263237718026\">Thanks, Ray<\/a>!<\/p>\n<p>To start with Google Cloud, you&#8217;ll need an account and a project. <a href=\"https:\/\/spring-gcp.saturnism.me\/getting-started\/google-cloud-platform\">Sign up for Google Cloud Platform (GCP)<\/a>, log in, and create a project. Open a <a href=\"https:\/\/console.cloud.google.com\/\">console<\/a> in your browser. A GCP project contains all cloud services and resources&#8211;such as virtual machines, network, load balancers&#8211;that you might use.<\/p>\n<p><strong>TIP<\/strong>: You can also download and install the <a href=\"https:\/\/cloud.google.com\/sdk\/\"><code>gcloud<\/code> CLI<\/a> if you want to run things locally.<\/p>\n<p>Enable the Google Kubernetes Engine API and Container Registry:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>gcloud services <span class=\"nb\">enable <\/span>container.googleapis.com containerregistry.googleapis.com\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<h3>\n  <a name=\"create-a-kubernetes-cluster\" href=\"#create-a-kubernetes-cluster\"><br \/>\n  <\/a><br \/>\n  Create a Kubernetes Cluster<br \/>\n<\/h3>\n<p>Run the following command to create a cluster for your apps.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>gcloud container clusters create CLUSTER_NAME <span class=\"se\">\\<\/span>\n<span class=\"nt\">--zone<\/span> us-central1-a <span class=\"se\">\\<\/span>\n<span class=\"nt\">--machine-type<\/span> n1-standard-4 <span class=\"se\">\\<\/span>\n<span class=\"nt\">--enable-autorepair<\/span> <span class=\"se\">\\<\/span>\n<span class=\"nt\">--enable-autoupgrade<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>I called my cluster <code>reactive-ms<\/code>. See GCP&#8217;s <a href=\"https:\/\/cloud.google.com\/compute\/docs\/regions-zones\/\">zones<\/a> and <a href=\"https:\/\/cloud.google.com\/compute\/docs\/machine-types\/\">machine-types<\/a> for other options. I found the <code>n1-standard-4<\/code> to be the minimum for JHipster.<\/p>\n<p>You created Docker images earlier to run with Minikube. Then, those images were deployed to Docker Hub or your local Docker registry. If you deployed to Docker Hub, you can use your deployment files as-is.<\/p>\n<p>For Google Cloud and its Kubernetes engine (GKE), you can also publish your images to your project&#8217;s registry. Thankfully, this is easy to do with Jib.<\/p>\n<p>Navigate to the <code>gateway<\/code> directory and run:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/gradlew bootJar <span class=\"nt\">-Pprod<\/span> jib <span class=\"nt\">-Djib<\/span>.to.image<span class=\"o\">=<\/span>gcr.io\/&lt;your-project-id&gt;\/gateway\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can get your project ID by running <code>gcloud projects list<\/code>.<\/p>\n<p>Repeat the process for <code>blog<\/code> and <code>store<\/code>. You can run these processes in parallel to speed things up.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">cd<\/span> ..\/blog\n.\/gradlew bootJar <span class=\"nt\">-Pprod<\/span> jib <span class=\"nt\">-Djib<\/span>.to.image<span class=\"o\">=<\/span>gcr.io\/&lt;your-project-id&gt;\/blog\n<span class=\"nb\">cd<\/span> ..\/store\n.\/gradlew bootJar <span class=\"nt\">-Pprod<\/span> jib <span class=\"nt\">-Djib<\/span>.to.image<span class=\"o\">=<\/span>gcr.io\/&lt;your-project-id&gt;\/store\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><strong>TIP<\/strong>: You might have to run <code>gcloud auth configure-docker<\/code> for Jib to publish to your GCP container registry.<\/p>\n<p>Then, in your <code>k8s\/**\/*-deployment.yml<\/code> files, add <code>gcr.io\/&lt;your-project-id&gt;<\/code> as a prefix. Remove the <code>imagePullPolicy<\/code> if you specified it earlier. For example:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">containers<\/span><span class=\"pi\">:<\/span>\n  <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway-app<\/span>\n    <span class=\"na\">image<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gcr.io\/jhipster7\/gateway<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>In the <code>k8s<\/code> directory, apply all the deployment descriptors to run all your images.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/kubectl-apply.sh <span class=\"nt\">-f<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can monitor the progress of your deployments with <code>kubectl get pods -n demo<\/code>.<\/p>\n<blockquote>\n<p><strong>TIP<\/strong>: If you make a mistake configuring JHipster Registry and need to deploy it, you can do so with the following command:<\/p>\n<pre class=\"highlight shell\"><code>kubectl apply <span class=\"nt\">-f<\/span> registry-k8s\/jhipster-registry.yml <span class=\"nt\">-n<\/span> demo\nkubectl rollout restart statefulset\/jhipster-registry <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<p>You&#8217;ll need to restart all your deployments if you changed any configuration settings that services need to retrieve.<\/p>\n<pre class=\"highlight shell\"><code>kubectl rollout restart deploy <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<\/blockquote>\n<h3>\n  <a name=\"access-your-gateway-on-google-cloud\" href=\"#access-your-gateway-on-google-cloud\"><br \/>\n  <\/a><br \/>\n  Access Your Gateway on Google Cloud<br \/>\n<\/h3>\n<p>Once everything is up and running, get the external IP of your gateway.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl get svc gateway <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You&#8217;ll need to add the external IP address as a valid redirect to your Okta OIDC app. Run <code>okta login<\/code>, open the returned URL in your browser, and sign in to the Okta Admin Console. Go to the <strong>Applications<\/strong> section, find your application, and edit it.<\/p>\n<p>Add the standard JHipster redirect URIs using the IP address. For example, <code>http:\/\/34.71.48.244:8080\/login\/oauth2\/code\/oidc<\/code> for the login redirect URI, and <code>http:\/\/34.71.48.244:8080<\/code> for the logout redirect URI.<\/p>\n<p>You can use the following command to set your gateway&#8217;s IP address as a variable you can curl.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nv\">EXTERNAL_IP<\/span><span class=\"o\">=<\/span><span class=\"si\">$(<\/span>kubectl get svc gateway <span class=\"nt\">-ojsonpath<\/span><span class=\"o\">=<\/span><span class=\"s2\">\"{.status.loadBalancer.ingress[0].ip}\"<\/span> <span class=\"nt\">-n<\/span> demo<span class=\"si\">)<\/span>\ncurl <span class=\"nv\">$EXTERNAL_IP<\/span>:8080\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Run <code>open http:\/\/$EXTERNAL_IP:8080<\/code>, and you should be able to sign in.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--BPVUVtiM--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/n06rd9t1ms56hc9qgwpb.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--BPVUVtiM--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/n06rd9t1ms56hc9qgwpb.png\" alt=\"First log in on GKE\" loading=\"lazy\" width=\"880\" height=\"427\"\/><\/a><\/p>\n<p>Great! Now that you know things work, let&#8217;s integrate better security, starting with HTTPS.<\/p>\n<h3>\n  <a name=\"add-https-to-your-reactive-gateway\" href=\"#add-https-to-your-reactive-gateway\"><br \/>\n  <\/a><br \/>\n  Add HTTPS to Your Reactive Gateway<br \/>\n<\/h3>\n<p>You should always use HTTPS. It&#8217;s one of the easiest ways to secure things, especially with the free certificates offered these days. Ray Tsang&#8217;s <a href=\"https:\/\/spring-gcp.saturnism.me\/deployment\/kubernetes\/load-balancing\/external-load-balancing\">External Load Balancing docs<\/a> was a big help in figuring out all these steps.<\/p>\n<p>You&#8217;ll need a static IP to assign your TLS (the official name for HTTPS) certificate.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>gcloud compute addresses create gateway-ingress-ip <span class=\"nt\">--global<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can run the following command to make sure it worked.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>gcloud compute addresses describe gateway-ingress-ip <span class=\"nt\">--global<\/span> <span class=\"nt\">--format<\/span><span class=\"o\">=<\/span><span class=\"s1\">'value(address)'<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Then, create a <code>k8s\/ingress.yml<\/code> file:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">apiVersion<\/span><span class=\"pi\">:<\/span> <span class=\"s\">networking.k8s.io\/v1<\/span>\n<span class=\"na\">kind<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Ingress<\/span>\n<span class=\"na\">metadata<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway<\/span>\n  <span class=\"na\">annotations<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">kubernetes.io\/ingress.global-static-ip-name<\/span><span class=\"pi\">:<\/span> <span class=\"s2\">\"<\/span><span class=\"s\">gateway-ingress-ip\"<\/span>\n<span class=\"na\">spec<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">rules<\/span><span class=\"pi\">:<\/span>\n    <span class=\"pi\">-<\/span> <span class=\"na\">http<\/span><span class=\"pi\">:<\/span>\n        <span class=\"na\">paths<\/span><span class=\"pi\">:<\/span>\n          <span class=\"pi\">-<\/span> <span class=\"na\">path<\/span><span class=\"pi\">:<\/span> <span class=\"s\">\/*<\/span>\n            <span class=\"na\">pathType<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ImplementationSpecific<\/span>\n            <span class=\"na\">backend<\/span><span class=\"pi\">:<\/span>\n              <span class=\"na\">service<\/span><span class=\"pi\">:<\/span>\n                <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway<\/span>\n                <span class=\"na\">port<\/span><span class=\"pi\">:<\/span>\n                  <span class=\"na\">number<\/span><span class=\"pi\">:<\/span> <span class=\"m\">8080<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Deploy it and make sure it worked.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl apply <span class=\"nt\">-f<\/span> ingress.yml <span class=\"nt\">-n<\/span> demo\n\n<span class=\"c\"># keep running this command displays an IP address<\/span>\n<span class=\"c\"># (hint: up arrow recalls the last command)<\/span>\nkubectl get ingress gateway <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>To use a TLS certificate, you must have a fully qualified domain name and configure it to point to the IP address. If you don&#8217;t have a real domain, you can use <a href=\"https:\/\/nip.io\/\">nip.io<\/a>.<\/p>\n<p>Set the IP in a variable, as well as the domain.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nv\">EXTERNAL_IP<\/span><span class=\"o\">=<\/span><span class=\"si\">$(<\/span>kubectl get ingress gateway <span class=\"nt\">-ojsonpath<\/span><span class=\"o\">=<\/span><span class=\"s2\">\"{.status.loadBalancer.ingress[0].ip}\"<\/span> <span class=\"nt\">-n<\/span> demo<span class=\"si\">)<\/span>\n<span class=\"nv\">DOMAIN<\/span><span class=\"o\">=<\/span><span class=\"s2\">\"<\/span><span class=\"k\">${<\/span><span class=\"nv\">EXTERNAL_IP<\/span><span class=\"k\">}<\/span><span class=\"s2\">.nip.io\"<\/span>\n\n<span class=\"c\"># Prove it works<\/span>\n<span class=\"nb\">echo<\/span> <span class=\"nv\">$DOMAIN<\/span>\ncurl <span class=\"nv\">$DOMAIN<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>To create a certificate, create a <code>k8s\/certificate.yml<\/code> file.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">cat<\/span> <span class=\"o\">&lt;&lt;<\/span> <span class=\"no\">EOF<\/span><span class=\"sh\"> &gt; certificate.yml\napiVersion: networking.gke.io\/v1\nkind: ManagedCertificate\nmetadata:\n  name: gateway-certificate\nspec:\n  domains:\n  # Replace the value with your domain name\n  - <\/span><span class=\"k\">${<\/span><span class=\"nv\">DOMAIN<\/span><span class=\"k\">}<\/span><span class=\"sh\">\n<\/span><span class=\"no\">EOF\n<\/span><\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Add the certificate to <code>ingress.yml<\/code>:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"nn\">...<\/span>\n<span class=\"na\">metadata<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">gateway<\/span>\n  <span class=\"na\">annotations<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">kubernetes.io\/ingress.global-static-ip-name<\/span><span class=\"pi\">:<\/span> <span class=\"s2\">\"<\/span><span class=\"s\">gateway-ingress-ip\"<\/span>\n    <span class=\"na\">networking.gke.io\/managed-certificates<\/span><span class=\"pi\">:<\/span> <span class=\"s2\">\"<\/span><span class=\"s\">gateway-certificate\"<\/span>\n<span class=\"nn\">...<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Deploy both files:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl apply <span class=\"nt\">-f<\/span> certificate.yml <span class=\"nt\">-f<\/span> ingress.yml <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Check your certificate&#8217;s status until it prints <code>Status: ACTIVE<\/code>:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl describe managedcertificate gateway-certificate <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>While you&#8217;re waiting, you can proceed to forcing HTTPS in the next step.<\/p>\n<h3>\n  <a name=\"force-https-with-spring-security\" href=\"#force-https-with-spring-security\"><br \/>\n  <\/a><br \/>\n  Force HTTPS with Spring Security<br \/>\n<\/h3>\n<p>Spring Security&#8217;s WebFlux support makes it easy to <a href=\"https:\/\/docs.spring.io\/spring-security\/site\/docs\/5.5.x\/reference\/html5\/#webflux-http-redirect\">redirect to HTTPS<\/a>. However, if you redirect <em>all<\/em> HTTPS requests, the Kubernetes health checks will fail because they receive a 302 instead of a 200.<\/p>\n<p>Crack open <code>SecurityConfiguration.java<\/code> in the gateway project and add the following code to the <code>springSecurityFilterChain()<\/code> method.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight java\"><code><span class=\"n\">http<\/span><span class=\"o\">.<\/span><span class=\"na\">redirectToHttps<\/span><span class=\"o\">(<\/span><span class=\"n\">redirect<\/span> <span class=\"o\">-&gt;<\/span> <span class=\"n\">redirect<\/span>\n    <span class=\"o\">.<\/span><span class=\"na\">httpsRedirectWhen<\/span><span class=\"o\">(<\/span><span class=\"n\">e<\/span> <span class=\"o\">-&gt;<\/span> <span class=\"n\">e<\/span><span class=\"o\">.<\/span><span class=\"na\">getRequest<\/span><span class=\"o\">().<\/span><span class=\"na\">getHeaders<\/span><span class=\"o\">().<\/span><span class=\"na\">containsKey<\/span><span class=\"o\">(<\/span><span class=\"s\">\"X-Forwarded-Proto\"<\/span><span class=\"o\">))<\/span>\n<span class=\"o\">);<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Rebuild the Docker image for the gateway project.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/gradlew bootJar <span class=\"nt\">-Pprod<\/span> jib <span class=\"nt\">-Djib<\/span>.to.image<span class=\"o\">=<\/span>gcr.io\/&lt;your-project-id&gt;\/gateway\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Run the following commands to start a rolling restart of gateway instances:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl rollout restart deployment gateway <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>TIP: Run <code>kubectl get deployments<\/code> to see your deployment names.<\/p>\n<p>Now you should get a 302 when you access your domain. <a href=\"https:\/\/httpie.io\/\">HTTPie<\/a> is a useful alternative to curl.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--a1gRxoVe--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ftfwxj7b9db0lr126sjp.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--a1gRxoVe--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/ftfwxj7b9db0lr126sjp.png\" alt=\"302 in HTTPie\" loading=\"lazy\" width=\"880\" height=\"420\"\/><\/a><\/p>\n<p>Update your Okta OIDC app to have <code>https:\/\/${DOMAIN}\/login\/oauth2\/code\/oidc<\/code> as a valid redirect URI. Add <code>https:\/\/${DOMAIN}<\/code> to the sign-out redirect URIs too.<\/p>\n<h2>\n  <a name=\"encrypt-your-kubernetes-secrets\" href=\"#encrypt-your-kubernetes-secrets\"><br \/>\n  <\/a><br \/>\n  Encrypt Your Kubernetes Secrets<br \/>\n<\/h2>\n<p>Congratulations! Now you have everything running on GKE, using HTTPS! However, you have a lot of plain-text secrets in your K8s YAML files.<\/p>\n<p>&#8220;But, wait!&#8221; you might say. Doesn&#8217;t <a href=\"https:\/\/kubernetes.io\/docs\/concepts\/configuration\/secret\/\">Kubernetes Secrets<\/a> solve everything?<\/p>\n<p>In my opinion, no. They&#8217;re just unencrypted base64-encoded strings stored in YAML files. There&#8217;s a good chance you&#8217;ll want to check in the <code>k8s<\/code> directory you created.<\/p>\n<p>Having secrets in your source code is a bad idea! The good news is most people (where most people = my followers) manage secrets externally.<\/p>\n<blockquote class=\"ltag__twitter-tweet\" data-url=\"https:\/\/twitter.com\/mraible\/status\/1387439868444397568\">\n<div class=\"ltag__twitter-tweet__main\" data-url=\"https:\/\/twitter.com\/mraible\/status\/1387439868444397568\">\n<div class=\"ltag__twitter-tweet__body\">\n      What&#8217;s your favorite way to protect secrets in your <a href=\"https:\/\/twitter.com\/kubernetesio\">@kubernetesio<\/a> YAML files?\n    <\/div>\n<p>\n      16:13 PM &#8211; 28 Apr 2021\n    <\/p>\n<\/p><\/div>\n<\/blockquote>\n<p><strong>NOTE<\/strong>: Watch <a href=\"https:\/\/www.youtube.com\/watch?v=cQAEK9PBY8U\">Kubernetes Secrets in 5 Minutes<\/a> if you want to learn more about Kubernetes Secrets.<\/p>\n<h3>\n  <a name=\"the-current-state-of-secret-management-in-kubernetes\" href=\"#the-current-state-of-secret-management-in-kubernetes\"><br \/>\n  <\/a><br \/>\n  The Current State of Secret Management in Kubernetes<br \/>\n<\/h3>\n<p>I recently noticed a tweet from <a href=\"https:\/\/twitter.com\/daniel_bilar\/status\/1379845799086022661\">Daniel Jacob Bilar<\/a> that links to a talk from FOSDEM 2021 on the <a href=\"https:\/\/fosdem.org\/2021\/schedule\/event\/kubernetes_secret_management\/\">current state of secret management within Kubernetes<\/a>. It&#8217;s an excellent overview of the various options.<\/p>\n<h3>\n  <a name=\"store-secrets-in-git-with-sealed-secrets-and-kubeseal\" href=\"#store-secrets-in-git-with-sealed-secrets-and-kubeseal\"><br \/>\n  <\/a><br \/>\n  Store Secrets in Git with Sealed Secrets and Kubeseal<br \/>\n<\/h3>\n<p><a href=\"https:\/\/bitnami.com\/\">Bitnami<\/a> has a <a href=\"https:\/\/github.com\/bitnami-labs\/sealed-secrets\">Sealed Secrets<\/a> Apache-licensed open source project. Its README explains how it works.<\/p>\n<blockquote>\n<p><strong>Problem<\/strong>: &#8220;I can manage all my K8s config in git, except Secrets.&#8221;<\/p>\n<p><strong>Solution<\/strong>: Encrypt your Secret into a SealedSecret, which is safe to store &#8211; even to a public repository. The SealedSecret can be decrypted only by the controller running in the target cluster, and nobody else (not even the original author) is able to obtain the original Secret from the SealedSecret.<\/p>\n<\/blockquote>\n<p><a href=\"https:\/\/dev.to\/stack-labs\/store-your-kubernetes-secrets-in-git-thanks-to-kubeseal-hello-sealedsecret-2i6h\">Store your Kubernetes Secrets in Git thanks to Kubeseal. Hello SealedSecret!<\/a> by <a href=\"https:\/\/twitter.com\/aurelievache\">Aur\u00e9lie Vache<\/a> provides an excellent overview of how to use it.<\/p>\n<p>First, you&#8217;ll need to install the Sealed Secrets CRD (Custom Resource Definition).<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl apply <span class=\"nt\">-f<\/span> https:\/\/github.com\/bitnami-labs\/sealed-secrets\/releases\/download\/v0.16.0\/controller.yaml\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Retrieve the certificate keypair that this controller generates.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl get secret <span class=\"nt\">-n<\/span> kube-system <span class=\"nt\">-l<\/span> sealedsecrets.bitnami.com\/sealed-secrets-key <span class=\"nt\">-o<\/span> yaml\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Copy the raw value of <code>tls.crt<\/code> and decode it. You can use the command line, or learn more about <a href=\"https:\/\/developer.okta.com\/docs\/guides\/implement-grant-type\/clientcreds\/main\/#base64-encode-the-client-id-and-client-secret\">base64 encoding\/decoding<\/a> in our documentation.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">echo<\/span> <span class=\"nt\">-n<\/span> &lt;paste-value-here&gt; | <span class=\"nb\">base64<\/span> <span class=\"nt\">--decode<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Put the raw value in a <code>tls.crt<\/code> file.<\/p>\n<p>Next, install Kubeseal. On macOS, you can use Homebrew. For other platforms, see <a href=\"https:\/\/github.com\/bitnami-labs\/sealed-secrets\/releases\/tag\/v0.16.0\">the release notes<\/a>.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>brew <span class=\"nb\">install <\/span>kubeseal\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>The major item you need to encrypt in this example is the <code>ENCRYPT_KEY<\/code> you used to encrypt the OIDC client secret. Run the following command to do this, where the value comes from your <code>k8s\/registry-k8s\/jhipster-registry.yml<\/code> file.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl create secret generic encrypt-key <span class=\"se\">\\<\/span>\n  <span class=\"nt\">--from-literal<\/span><span class=\"o\">=<\/span><span class=\"nv\">ENCRYPT_KEY<\/span><span class=\"o\">=<\/span><span class=\"s1\">'your-value-here'<\/span> <span class=\"se\">\\<\/span>\n  <span class=\"nt\">--dry-run<\/span><span class=\"o\">=<\/span>client <span class=\"nt\">-o<\/span> yaml <span class=\"o\">&gt;<\/span> secrets.yml\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Next, use <code>kubeseal<\/code> to convert the secrets to encrypted secrets.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubeseal <span class=\"nt\">--cert<\/span> tls.crt <span class=\"nt\">--format<\/span><span class=\"o\">=<\/span>yaml <span class=\"nt\">-n<\/span> demo &lt; secrets.yml <span class=\"o\">&gt;<\/span> sealed-secrets.yml\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Remove the original secrets file and deploy your sealed secrets.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code><span class=\"nb\">rm <\/span>secrets.yml\nkubectl apply <span class=\"nt\">-n<\/span> demo <span class=\"nt\">-f<\/span> sealed-secrets.yml <span class=\"o\">&amp;&amp;<\/span> kubectl get <span class=\"nt\">-n<\/span> demo sealedsecret encrypt-key\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<h3>\n  <a name=\"configure-jhipster-registry-to-use-the-sealed-secret\" href=\"#configure-jhipster-registry-to-use-the-sealed-secret\"><br \/>\n  <\/a><br \/>\n  Configure JHipster Registry to use the Sealed Secret<br \/>\n<\/h3>\n<p>In <code>k8s\/registry-k8s\/jhipster-registry.yml<\/code>, change the <code>ENCRYPT_KEY<\/code> to use your new secret.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"nn\">...<\/span>\n<span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ENCRYPT_KEY<\/span>\n  <span class=\"na\">valueFrom<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">secretKeyRef<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">encrypt-key<\/span>\n      <span class=\"na\">key<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ENCRYPT_KEY<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><strong>TIP<\/strong>: You should be able to encrypt other secrets, like your database passwords, using a similar technique.<\/p>\n<p>Now, redeploy JHipster Registry and restart all your deployments.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>.\/kubectl-apply.sh <span class=\"nt\">-f<\/span>\nkubectl rollout restart deployment <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>You can use port-forwarding to see the JHipster Registry locally.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl port-forward svc\/jhipster-registry <span class=\"nt\">-n<\/span> demo 8761\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--xw0UN82Q--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/b0l9lkw1n9csllcrapv3.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--xw0UN82Q--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/b0l9lkw1n9csllcrapv3.png\" alt=\"Port-forwarding the Registry to localhost\" loading=\"lazy\" width=\"880\" height=\"388\"\/><\/a><\/p>\n<h3>\n  <a name=\"google-cloud-secret-manager\" href=\"#google-cloud-secret-manager\"><br \/>\n  <\/a><br \/>\n  Google Cloud Secret Manager<br \/>\n<\/h3>\n<p>Google Cloud has a <a href=\"https:\/\/spring-gcp.saturnism.me\/app-dev\/cloud-services\/secret-management\">Secret Manager<\/a> you can use to store your secrets. There&#8217;s even a <a href=\"https:\/\/cloud.spring.io\/spring-cloud-static\/spring-cloud-gcp\/current\/reference\/html\/#secret-manager\">Spring Boot starter<\/a> to make it convenient to retrieve these values in your app.<\/p>\n<p>For example, you could store your database password in a properties file.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight properties\"><code><span class=\"py\">spring.datasource.password<\/span><span class=\"p\">=<\/span><span class=\"s\">${sm:\/\/my-db-password}<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>This is pretty slick, but I like to remain cloud-agnostic. Also, I like how the JHipster Registry allows me to store encrypted secrets in Git.<\/p>\n<h3>\n  <a name=\"use-spring-vault-for-external-secrets\" href=\"#use-spring-vault-for-external-secrets\"><br \/>\n  <\/a><br \/>\n  Use Spring Vault for External Secrets<br \/>\n<\/h3>\n<p>Using an external key management solution like <a href=\"https:\/\/www.hashicorp.com\/products\/vault\">HashiCorp Vault<\/a> is also recommended. The JHipster Registry will have <a href=\"https:\/\/github.com\/jhipster\/jhipster-registry\/pull\/498\">Vault support in its next release<\/a>.<\/p>\n<p>In the meantime, I recommend reading <a href=\"https:\/\/developer.okta.com\/blog\/2020\/05\/04\/spring-vault\">Secure Secrets With Spring Cloud Config and Vault<\/a>.<\/p>\n<h2>\n  <a name=\"scale-your-reactive-java-microservices\" href=\"#scale-your-reactive-java-microservices\"><br \/>\n  <\/a><br \/>\n  Scale Your Reactive Java Microservices<br \/>\n<\/h2>\n<p>You can scale your instances using the <code>kubectl scale<\/code> command.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>kubectl scale deployments\/store <span class=\"nt\">--replicas<\/span><span class=\"o\">=<\/span>2 <span class=\"nt\">-n<\/span> demo\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Scaling will work just fine for the microservice apps because they&#8217;re set up as OAuth 2.0 resource servers and are therefore stateless.<\/p>\n<p>However, the gateway uses Spring Security&#8217;s OIDC login feature and stores the access tokens in the session. So if you scale it, sessions won&#8217;t be shared. Single sign-on should still work; you&#8217;ll just have to do the OAuth dance to get tokens if you hit a different instance.<\/p>\n<p>To synchronize sessions, you can use <a href=\"https:\/\/developer.okta.com\/blog\/2020\/12\/14\/spring-session-redis\">Spring Session and Redis<\/a> with JHipster.<\/p>\n<blockquote>\n<p><strong>CAUTION<\/strong>: If you leave everything running on Google Cloud, you will be charged for usage. Therefore, I recommend removing your cluster or deleting your namespace (<code>kubectl delete ns demo<\/code>) to reduce your cost.<\/p>\n<pre class=\"highlight plaintext\"><code>gcloud container clusters delete &lt;cluster-name&gt; --zone=us-central1-a\n<\/code><\/pre>\n<p>You can delete your Ingress IP address too:<\/p>\n<pre class=\"highlight plaintext\"><code>gcloud compute addresses delete gateway-ingress-ip --global\n<\/code><\/pre>\n<\/blockquote>\n<h2>\n  <a name=\"monitor-your-kubernetes-cluster-with-k9s\" href=\"#monitor-your-kubernetes-cluster-with-k9s\"><br \/>\n  <\/a><br \/>\n  Monitor Your Kubernetes Cluster with K9s<br \/>\n<\/h2>\n<p>Using <code>kubectl<\/code> to monitor your Kubernetes cluster can get tiresome. That&#8217;s where <a href=\"https:\/\/github.com\/derailed\/k9s\">K9s<\/a> can be helpful. It provides a terminal UI to interact with your Kubernetes clusters. K9s was created by my good friend <a href=\"https:\/\/twitter.com\/kitesurfer\">Fernand Galiana<\/a>. He&#8217;s also created a commercial version called <a href=\"https:\/\/k9salpha.io\/\">K9sAlpha<\/a>.<\/p>\n<p>To install it on macOS, run <code>brew install k9s<\/code>. Then run <code>k9s -n demo<\/code> to start it. You can navigate to your pods, select them with <strong>Return<\/strong>, and navigate back up with <strong>Esc<\/strong>.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--z9XRmdwS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/54ickve8sfhbp0ppvm03.gif\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--z9XRmdwS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/54ickve8sfhbp0ppvm03.gif\" alt=\"K9s in Action\" loading=\"lazy\" width=\"880\" height=\"430\" data-animated=\"true\"\/><\/a><\/p>\n<p>There&#8217;s also <a href=\"https:\/\/github.com\/kdash-rs\/kdash\">KDash<\/a>, from JHipster co-lead, <a href=\"https:\/\/twitter.com\/deepu105\">Deepu K Sasidharan<\/a>. It&#8217;s a simple K8s terminal dashboard built with Rust. Deepu recently <a href=\"https:\/\/twitter.com\/deepu105\/status\/1383017556546584578\">released an MVP of the project<\/a>.<\/p>\n<p>If for some reason you don&#8217;t like CLI&#8217;s, you can try <a href=\"https:\/\/www.kubernetic.com\/\">Kubernetic<\/a>.<\/p>\n<h2>\n  <a name=\"continuous-integration-and-delivery-of-jhipster-microservices\" href=\"#continuous-integration-and-delivery-of-jhipster-microservices\"><br \/>\n  <\/a><br \/>\n  Continuous Integration and Delivery of JHipster Microservices<br \/>\n<\/h2>\n<p>This tutorial doesn&#8217;t mention continuous integration and delivery of your reactive microservice architecture. I plan to cover that in a future post. If you have a solution you like, please leave a comment.<\/p>\n<h2>\n  <a name=\"spring-on-google-cloud-platform\" href=\"#spring-on-google-cloud-platform\"><br \/>\n  <\/a><br \/>\n  Spring on Google Cloud Platform<br \/>\n<\/h2>\n<p>JHipster uses Docker containers to run all its databases in this example. However, there are a number of Google Cloud services you can use as alternatives. See the <a href=\"https:\/\/spring.io\/projects\/spring-cloud-gcp\">Spring Cloud GCP project on GitHub<\/a> for more information.<\/p>\n<p>I didn&#8217;t mention Testcontainers in this post. However, <a href=\"https:\/\/atomfrede.gitlab.io\/2019\/05\/jhipster-with-testcontainers\/\">JHipster does support using them<\/a>. Testcontainers also has a <a href=\"https:\/\/www.testcontainers.org\/modules\/gcloud\/\">GCloud Module<\/a>.<\/p>\n<h2>\n  <a name=\"why-not-istio\" href=\"#why-not-istio\"><br \/>\n  <\/a><br \/>\n  Why Not Istio?<br \/>\n<\/h2>\n<p>I didn&#8217;t use Istio in this example because I didn&#8217;t want to complicate things. Learning Kubernetes is hard enough without learning another system on top of it. Istio acts as a network between your containers that can do networky things like authentication, authorization, monitoring, and retries. I like to think of it as AOP for containers.<\/p>\n<p>If you&#8217;d like to see how to use JHipster with Istio, see <a href=\"https:\/\/dev.to\/deepu105\/how-to-set-up-java-microservices-with-istio-service-mesh-on-kubernetes-5bkn\">How to set up Java microservices with Istio service mesh on Kubernetes<\/a> by JHipster co-lead <a href=\"https:\/\/twitter.com\/deepu105\">Deepu K Sasidharan<\/a>.<\/p>\n<p>Fernand Galiana recommends checking out BPF (Berkeley Packet Filter) and <a href=\"https:\/\/cilium.io\/\">Cilium<\/a>. Cilium is open source software for transparently providing and securing the network and API connectivity between application services deployed using Linux container management platforms such as Kubernetes.<\/p>\n<h2>\n  <a name=\"learn-more-about-kubernetes-spring-boot-and-jhipster\" href=\"#learn-more-about-kubernetes-spring-boot-and-jhipster\"><br \/>\n  <\/a><br \/>\n  Learn More About Kubernetes, Spring Boot, and JHipster<br \/>\n<\/h2>\n<p>This blog post showed you how to deploy your reactive Java microservices to production using Kubernetes. JHipster did much of the heavy lifting for you since it generated all the YAML-based deployment descriptors. Since no one really likes writing YAML, I&#8217;m calling that a win!<\/p>\n<p>You learned how to use JHipster Registry to encrypt your secrets and configure Git as a configuration source for Spring Cloud Config. Bitnami&#8217;s Sealed Secrets is a nice companion to encrypt the secrets in your Kubernetes deployment descriptors.<\/p>\n<p>For more information about storing your secrets externally, these additional resources might help.<\/p>\n<p>You can find the source code for this example on GitHub in our <a href=\"https:\/\/github.com\/oktadev\/java-microservices-examples\">Java microservices examples repository<\/a>.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight shell\"><code>git clone https:\/\/github.com\/oktadev\/java-microservices-examples.git\n<span class=\"nb\">cd <\/span>java-microservices-examples\/jhipster-k8s\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>See JHipster&#8217;s documentation on <a href=\"https:\/\/www.jhipster.tech\/kubernetes\/\">Kubernetes<\/a> and <a href=\"https:\/\/www.jhipster.tech\/gcp\/\">GCP<\/a> if you&#8217;d like more concise instructions.<\/p>\n<p>If you enjoyed this post, I think you&#8217;ll like these others as well:<\/p>\n<p>If you have any questions, please ask them in the comments below.<\/p>\n<p>To be notified when we publish new blog posts, follow us on <a href=\"https:\/\/twitter.com\/oktadev\">Twitter<\/a> or <a href=\"https:\/\/www.linkedin.com\/company\/oktadev\">LinkedIn<\/a>. We frequently publish videos to our <a href=\"https:\/\/youtube.com\/c\/oktadev\">YouTube channel<\/a> too. <a href=\"https:\/\/youtube.com\/c\/oktadev?sub_confirmation=1\">Subscribe today<\/a>!<\/p>\n<p><em>A huge thanks goes to <a href=\"https:\/\/twitter.com\/kitesurfer\">Fernand Galiana<\/a> for his review and detailed feedback.<\/em><\/p>\n<\/p><\/div>\n<p><script async src=\"\/\/platform.twitter.com\/widgets.js\" charset=\"utf-8\"><\/script><br \/>\n<br \/><\/p>\n","protected":false},"excerpt":{"rendered":"<p>When your business or application is successful, it needs to scale. Not just technology-wise, but human-wise. When you&#8217;re growing rapidly, it can be difficult to hire developers fast enough. Using a microservices architecture for your apps can allow you to divide up ownership and responsibilities, and scale teams along with your code. Kubernetes is an &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/deploy-jhipster-microservices-to-gcp-with-kubernetes\/\"> <span class=\"screen-reader-text\">Deploy JHipster Microservices to GCP with Kubernetes<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":1022,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1021"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=1021"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1021\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media\/1022"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=1021"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=1021"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=1021"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}