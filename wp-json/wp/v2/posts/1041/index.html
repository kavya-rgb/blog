{"id":1041,"date":"2022-03-09T13:48:07","date_gmt":"2022-03-09T13:48:07","guid":{"rendered":"http:\/\/localhost\/wordpress\/azure-functions-deployment-using-github-actions\/"},"modified":"2022-03-09T13:48:07","modified_gmt":"2022-03-09T13:48:07","slug":"azure-functions-deployment-using-github-actions","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/azure-functions-deployment-using-github-actions\/","title":{"rendered":"Azure Functions Deployment using GitHub Actions"},"content":{"rendered":"<p> <br \/>\n<\/p>\n<div data-article-id=\"1017295\" id=\"article-body\">\n<p>Have you ever been in a situation where you have been asked to set up CI\/CD for your new Azure Function App? Have the requirements been to use a single repository and workflow in GitHub to distribute the application to deployment slots?<\/p>\n<p>In this post, you will follow step by step instructions to set up deployment slots within your Azure Function resource, implement a branching strategy in your repository, identify and create environments in GitHub, and assemble a single workflow to run in GitHub Actions as your CI\/CD.<\/p>\n<h2>\n  <a name=\"what-you-need\" href=\"#what-you-need\"><br \/>\n  <\/a><br \/>\n  What you need<br \/>\n<\/h2>\n<p>You would have already created the Azure Function resource in advance of following the below. You will also need access to this resource to configure it and download publication profiles.<\/p>\n<h2>\n  <a name=\"deployment-slots\" href=\"#deployment-slots\"><br \/>\n  <\/a><br \/>\n  Deployment Slots<br \/>\n<\/h2>\n<p>My workflow for this project will be targeting three deployment slots:<\/p>\n<p>Deployment Slots allow me to run multiple environments within a single Azure Function App. This will provide a unique public endpoint for each of them, allowing me to develop and test without impacting the staging and live slots. I haven&#8217;t listed a production slot, and this is because a default slot is available after creating an Azure Function for production use.<\/p>\n<p>If you want to create a Deployment Slot:<\/p>\n<ol>\n<li>\n<p>Open Azure Function App<\/p>\n<\/li>\n<li>\n<p>Select <strong>Deployment Slots<\/strong> from the side menu<\/p>\n<\/li>\n<li>\n<p>Select <strong>Add Slot<\/strong><\/p>\n<\/li>\n<li>\n<p>Provide a name for your slot. The Function App name will automatically appear at the start, so it&#8217;s unique across the <code>.azurewebsites.net<\/code> domain. You can then click the <strong>Add<\/strong> button when you are ready.<\/p>\n<\/li>\n<\/ol>\n<h2>\n  <a name=\"branch-strategy\" href=\"#branch-strategy\"><br \/>\n  <\/a><br \/>\n  Branch Strategy<br \/>\n<\/h2>\n<p>I will be using three git branches to represent the slots I&#8217;ve created above. They are:<\/p>\n<p><strong>main<\/strong> (will deploy to Staging slot)<\/p>\n<p><strong>test<\/strong> (will deploy to Test slot)<\/p>\n<p><strong>develop<\/strong> (will deploy to the Development slot)<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--tvb7Vymr--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645342952895\/DLSY--gfv.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--tvb7Vymr--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645342952895\/DLSY--gfv.png\" alt=\"image.png\" loading=\"lazy\" width=\"291\" height=\"143\"\/><\/a><\/p>\n<p>I will not require a branch for production as I will either run a manual Swap of the Staging slot with Production or incorporate a release approval gate that will trigger the Swap with Staging and Production in the workflow.<\/p>\n<h2>\n  <a name=\"publish-profile\" href=\"#publish-profile\"><br \/>\n  <\/a><br \/>\n  Publish Profile<br \/>\n<\/h2>\n<p>To publish our code to a deployment slot, we require the <strong>Publish Profile<\/strong> for each slot (excluding production). To do this, follow each step below and repeat for each slot you have:<\/p>\n<ol>\n<li>\n<p>Open Azure Function App<\/p>\n<\/li>\n<li>\n<p>Select <strong>Deployment Slots<\/strong> from the side menu<\/p>\n<\/li>\n<li>\n<p>Select a Slot (one with the blue hyperlink)<\/p>\n<\/li>\n<li>\n<p>At the top of the window, select <strong>Get Publish Profile<\/strong>. This will download a copy of the publish profile as a file.<\/p>\n<\/li>\n<\/ol>\n<p>Repeat these steps per deployment slot.<\/p>\n<h2>\n  <a name=\"environments\" href=\"#environments\"><br \/>\n  <\/a><br \/>\n  Environments<br \/>\n<\/h2>\n<p>I will create an environment in GitHub for every deployment slot I created, allowing me to associate each publish profile to its environment using secrets. To create an environment:<\/p>\n<ol>\n<li>\n<p>Open your GitHub repository in the Web UI<\/p>\n<\/li>\n<li>\n<p>Select <strong>Settings<\/strong><\/p>\n<\/li>\n<li>\n<p>From the side menu, select <strong>Environments<\/strong><\/p>\n<\/li>\n<li>\n<p>Click the <strong>New environment<\/strong> button<\/p>\n<\/li>\n<li>\n<p>Give your environment a name and click <strong>Configure environment<\/strong><\/p>\n<\/li>\n<\/ol>\n<p>Repeating the above steps, I have the following environments:<\/p>\n<ul>\n<li>Development<\/li>\n<li>Test<\/li>\n<li>Production (where we will publish to the Staging slot)<\/li>\n<\/ul>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Nwwto6Vv--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645343539268\/kfWPEr6AK.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Nwwto6Vv--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645343539268\/kfWPEr6AK.png\" alt=\"image.png\" loading=\"lazy\" width=\"617\" height=\"293\"\/><\/a><\/p>\n<p>I have enabled <strong>Required reviewers<\/strong> in each environment and added myself. When we run a job within a workflow against any of these environments, I do not want it to proceed until my approval. If you don&#8217;t have this selected, our workflow will automatically deploy to the environment once the Pull Request merges.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--TjqRSRGj--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645343525105\/VZOvcM8O-.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--TjqRSRGj--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645343525105\/VZOvcM8O-.png\" alt=\"image.png\" loading=\"lazy\" width=\"542\" height=\"184\"\/><\/a><\/p>\n<h2>\n  <a name=\"secrets\" href=\"#secrets\"><br \/>\n  <\/a><br \/>\n  Secrets<br \/>\n<\/h2>\n<p>Within each environment, we will be creating a new secret that will contain the contents of the publish profile. First, select <strong>Add Secret<\/strong> under the heading <strong>Environments secrets<\/strong> in the environment you are configuring.<\/p>\n<p>In the <strong>Name<\/strong> field, give your secret an appropriate name. The name you provide will be used when referring to the secret in the workflow, so make it identifiable. In the <strong>Value<\/strong> field, copy and paste the content from the <strong>Publish Profile<\/strong> file. This includes all the information required for authenticating and deploying your Azure Function App to the correct slot. Select <strong>Save<\/strong> when you are ready.<\/p>\n<p>For this post, my secret will be named <strong>AZURE_FUNCTIONAPP_PUBLISH_PROFILE<\/strong>.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--5ND6q0Gq--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645344731232\/7R8I21YD0.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--5ND6q0Gq--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1645344731232\/7R8I21YD0.png\" alt=\"image.png\" loading=\"lazy\" width=\"332\" height=\"128\"\/><\/a><\/p>\n<h2>\n  <a name=\"workflow\" href=\"#workflow\"><br \/>\n  <\/a><br \/>\n  Workflow<br \/>\n<\/h2>\n<p>I will break down each part of the workflow we will use to deploy our Azure Function.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Function App Deployment<\/span>\n<span class=\"na\">on<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">push<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">branches<\/span><span class=\"pi\">:<\/span> \n      <span class=\"pi\">-<\/span> <span class=\"s\">main<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"s\">test<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"s\">develop<\/span>\n  <span class=\"na\">workflow_dispatch<\/span><span class=\"pi\">:<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Above is the first part of our workflow. I have defined the workflow&#8217;s name as <strong>Function App Deployment<\/strong> and specified this workflow to run when <strong>push<\/strong> (updates) happen on one of the three branches. I have also included <strong>workflow_dispatch<\/strong>, so I can run the workflow manually.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">jobs<\/span><span class=\"pi\">:<\/span>\n\n  <span class=\"na\">cd-build-deploy-dev<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Development<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Development<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/develop'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Next, we define the jobs we are going to run. We will have in total three jobs, one for each environment. First, we will define the development environment job. We will set the job id to <strong>cd-build-deploy-dev<\/strong> and the name to <strong>Continuous Deployment &#8211; Development<\/strong>. We will be using <strong>ubuntu-latest<\/strong>for all the runs, but we will be setting <strong>environments<\/strong> to each environment we create in GitHub.<\/p>\n<p>We use an <strong>if<\/strong> statement here to say, &#8220;if push happens on the develop branch, run the job&#8221;. We do this for all three of our jobs to run based on the branch push. If the if statement is not met, the job will skip.<\/p>\n<p>And we define environment variables for the job. These will be:<\/p>\n<p><strong>AZURE_FUNCTIONAPP_NAME<\/strong> &#8211; the name of the function app<\/p>\n<p><strong>AZURE_FUNCTIONAPP_PACKAGE_PATH<\/strong> &#8211; the path to the code (mine is at the root of the repo so I specified &#8220;.&#8221;)<\/p>\n<p><strong>DOTNET_VERSION<\/strong> &#8211; the version of .NET I am using.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code>    <span class=\"na\">steps<\/span><span class=\"pi\">:<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Checkout<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/checkout@main<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Setup DotNet 3.1.x Environment<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/setup-dotnet@v1<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">dotnet-version<\/span><span class=\"pi\">:<\/span> <span class=\"s\">3.1.x<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Resolve Project Dependencies Using Dotnet<\/span>\n        <span class=\"na\">shell<\/span><span class=\"pi\">:<\/span> <span class=\"s\">bash<\/span>\n        <span class=\"na\">run<\/span><span class=\"pi\">:<\/span> <span class=\"pi\">|<\/span>\n          <span class=\"s\">pushd '.\/${{ env.AZURE_FUNCTIONAPP_PACKAGE_PATH }}'<\/span>\n          <span class=\"s\">dotnet build --configuration Release --output .\/output<\/span>\n          <span class=\"s\">popd<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Run Azure Functions Action<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Azure\/functions-action@v1<\/span>\n        <span class=\"na\">id<\/span><span class=\"pi\">:<\/span> <span class=\"s\">fa<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">app-name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ env.AZURE_FUNCTIONAPP_NAME }}<\/span>\n          <span class=\"na\">package<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">${{<\/span><span class=\"nv\"> <\/span><span class=\"s\">env.AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"nv\"> <\/span><span class=\"s\">}}\/output'<\/span>\n          <span class=\"na\">publish-profile<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE }}<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Once the job is configured, we want to configure each step we require to get the deployment going.<\/p>\n<p>The first step is <strong>Checkout<\/strong>; this will clone the branch to the local runner.<\/p>\n<p>The second step will set up .NET on the runner. Here I have specified to install the latest version of 3.1. We are using the GitHub action project <a href=\"https:\/\/github.com\/actions\/setup-dotnet\">setup-dotnet<\/a> to complete the installation on the runner.<\/p>\n<p>The third step will trigger a build ready for the function app to deploy.<\/p>\n<p>The final step is for deployment to take place to our Function App. We specify environment variables and GitHub secrets to complete the app name, package and publish profile parameters. This uses a supplied GitHub action from Microsoft called <a href=\"https:\/\/github.com\/Azure\/functions-action\">functions-action<\/a>.<\/p>\n<p>Now you have to complete this for the other jobs (listed below) and copy the steps below each job (the steps should be identical).<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code>  <span class=\"na\">cd-build-deploy-test<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Test<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Test<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/test'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code>  <span class=\"na\">cd-build-deploy-prod<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Production<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Production<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/main'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>The final workflow should look similar to this:<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight yaml\"><code><span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Function App Deployment<\/span>\n<span class=\"na\">on<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">push<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">branches<\/span><span class=\"pi\">:<\/span> \n      <span class=\"pi\">-<\/span> <span class=\"s\">main<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"s\">test<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"s\">develop<\/span>\n  <span class=\"na\">workflow_dispatch<\/span><span class=\"pi\">:<\/span>\n\n<span class=\"na\">jobs<\/span><span class=\"pi\">:<\/span>\n  <span class=\"na\">cd-build-deploy-dev<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Development<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Development<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/develop'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n\n    <span class=\"na\">steps<\/span><span class=\"pi\">:<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Checkout<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/checkout@main<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Setup DotNet 3.1.x Environment<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/setup-dotnet@v1<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">dotnet-version<\/span><span class=\"pi\">:<\/span> <span class=\"s\">3.1.x<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Resolve Project Dependencies Using Dotnet<\/span>\n        <span class=\"na\">shell<\/span><span class=\"pi\">:<\/span> <span class=\"s\">bash<\/span>\n        <span class=\"na\">run<\/span><span class=\"pi\">:<\/span> <span class=\"pi\">|<\/span>\n          <span class=\"s\">pushd '.\/${{ env.AZURE_FUNCTIONAPP_PACKAGE_PATH }}'<\/span>\n          <span class=\"s\">dotnet build --configuration Release --output .\/output<\/span>\n          <span class=\"s\">popd<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Run Azure Functions Action<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Azure\/functions-action@v1<\/span>\n        <span class=\"na\">id<\/span><span class=\"pi\">:<\/span> <span class=\"s\">fa<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">app-name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ env.AZURE_FUNCTIONAPP_NAME }}<\/span>\n          <span class=\"na\">package<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">${{<\/span><span class=\"nv\"> <\/span><span class=\"s\">env.AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"nv\"> <\/span><span class=\"s\">}}\/output'<\/span>\n          <span class=\"na\">publish-profile<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE }}<\/span>\n\n  <span class=\"na\">cd-build-deploy-test<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Test<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Test<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/test'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n\n    <span class=\"na\">steps<\/span><span class=\"pi\">:<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Checkout<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/checkout@main<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Setup DotNet 3.1.x Environment<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/setup-dotnet@v1<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">dotnet-version<\/span><span class=\"pi\">:<\/span> <span class=\"s\">3.1.x<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Resolve Project Dependencies Using Dotnet<\/span>\n        <span class=\"na\">shell<\/span><span class=\"pi\">:<\/span> <span class=\"s\">bash<\/span>\n        <span class=\"na\">run<\/span><span class=\"pi\">:<\/span> <span class=\"pi\">|<\/span>\n          <span class=\"s\">pushd '.\/${{ env.AZURE_FUNCTIONAPP_PACKAGE_PATH }}'<\/span>\n          <span class=\"s\">dotnet build --configuration Release --output .\/output<\/span>\n          <span class=\"s\">popd<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Run Azure Functions Action<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Azure\/functions-action@v1<\/span>\n        <span class=\"na\">id<\/span><span class=\"pi\">:<\/span> <span class=\"s\">fa<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">app-name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ env.AZURE_FUNCTIONAPP_NAME }}<\/span>\n          <span class=\"na\">package<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">${{<\/span><span class=\"nv\"> <\/span><span class=\"s\">env.AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"nv\"> <\/span><span class=\"s\">}}\/output'<\/span>\n          <span class=\"na\">publish-profile<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE }}<\/span>\n\n  <span class=\"na\">cd-build-deploy-prod<\/span><span class=\"pi\">:<\/span>\n    <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Continuous Deployment - Production<\/span>\n    <span class=\"na\">runs-on<\/span><span class=\"pi\">:<\/span> <span class=\"s\">ubuntu-latest<\/span>\n    <span class=\"na\">environment<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Production<\/span>\n    <span class=\"na\">if<\/span><span class=\"pi\">:<\/span> <span class=\"s\">github.ref == 'refs\/heads\/main'<\/span>\n    <span class=\"na\">env<\/span><span class=\"pi\">:<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_NAME<\/span><span class=\"pi\">:<\/span> <span class=\"s\">MyHTTPTrigger<\/span>\n      <span class=\"na\">AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">.'<\/span>\n      <span class=\"na\">DOTNET_VERSION<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">3.0.13'<\/span>\n\n    <span class=\"na\">steps<\/span><span class=\"pi\">:<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Checkout<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/checkout@main<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Setup DotNet 3.1.x Environment<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">actions\/setup-dotnet@v1<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">dotnet-version<\/span><span class=\"pi\">:<\/span> <span class=\"s\">3.1.x<\/span>\n\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Resolve Project Dependencies Using Dotnet<\/span>\n        <span class=\"na\">shell<\/span><span class=\"pi\">:<\/span> <span class=\"s\">bash<\/span>\n        <span class=\"na\">run<\/span><span class=\"pi\">:<\/span> <span class=\"pi\">|<\/span>\n          <span class=\"s\">pushd '.\/${{ env.AZURE_FUNCTIONAPP_PACKAGE_PATH }}'<\/span>\n          <span class=\"s\">dotnet build --configuration Release --output .\/output<\/span>\n          <span class=\"s\">popd<\/span>\n      <span class=\"pi\">-<\/span> <span class=\"na\">name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Run Azure Functions Action<\/span>\n        <span class=\"na\">uses<\/span><span class=\"pi\">:<\/span> <span class=\"s\">Azure\/functions-action@v1<\/span>\n        <span class=\"na\">id<\/span><span class=\"pi\">:<\/span> <span class=\"s\">fa<\/span>\n        <span class=\"na\">with<\/span><span class=\"pi\">:<\/span>\n          <span class=\"na\">app-name<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ env.AZURE_FUNCTIONAPP_NAME }}<\/span>\n          <span class=\"na\">package<\/span><span class=\"pi\">:<\/span> <span class=\"s1\">'<\/span><span class=\"s\">${{<\/span><span class=\"nv\"> <\/span><span class=\"s\">env.AZURE_FUNCTIONAPP_PACKAGE_PATH<\/span><span class=\"nv\"> <\/span><span class=\"s\">}}\/output'<\/span>\n          <span class=\"na\">publish-profile<\/span><span class=\"pi\">:<\/span> <span class=\"s\">${{ secrets.AZURE_FUNCTIONAPP_PUBLISH_PROFILE }}<\/span>\n\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Commit the workflow once completed and update your branches, so they are up-to-date.<\/p>\n<h2>\n  <a name=\"deployment\" href=\"#deployment\"><br \/>\n  <\/a><br \/>\n  Deployment<br \/>\n<\/h2>\n<p>Now we have our workflow in place, we can trigger the workflow either by pushing to a particular branch or running manually.<\/p>\n<p>For this post, I am going to trigger the deployment manually. To do this, I select the <strong>Actions<\/strong> tab and select my workflow from the left side menu. <\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Bvtf-Ra8--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1646828894058\/V-c67tp5E.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Bvtf-Ra8--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1646828894058\/V-c67tp5E.png\" alt=\"image.png\" loading=\"lazy\" width=\"114\" height=\"58\"\/><\/a><\/p>\n<p>From there, I click on the <strong>Run workflow<\/strong> button and select the <strong>develop<\/strong> branch to deploy the function app to the development slot. <\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vh-yzJKD--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1646828877210\/hqAGUIB6O.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--vh-yzJKD--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/cdn.hashnode.com\/res\/hashnode\/image\/upload\/v1646828877210\/hqAGUIB6O.png\" alt=\"image.png\" loading=\"lazy\" width=\"316\" height=\"166\"\/><\/a><\/p>\n<p>If you&#8217;ve set up reviewers on your environments, the deployment will not start until a reviewer approves the job.<\/p>\n<p>Once the deployment completes and I can confirm it&#8217;s working as intended, I can repeat the above to deploy to the testing slot and then the stagging slot.<\/p>\n<p>Once I am happy for the app to go into the production slot, I will use the <strong>Swap<\/strong> button in the <strong>Deployment<\/strong> blade to swap Stagging with Production (within the Azure Function App resource).<\/p>\n<\/p><\/div>\n\n","protected":false},"excerpt":{"rendered":"<p>Have you ever been in a situation where you have been asked to set up CI\/CD for your new Azure Function App? Have the requirements been to use a single repository and workflow in GitHub to distribute the application to deployment slots? In this post, you will follow step by step instructions to set up &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/azure-functions-deployment-using-github-actions\/\"> <span class=\"screen-reader-text\">Azure Functions Deployment using GitHub Actions<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":1042,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1041"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=1041"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1041\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media\/1042"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=1041"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=1041"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=1041"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}