{"id":1340,"date":"2022-03-09T17:42:58","date_gmt":"2022-03-09T17:42:58","guid":{"rendered":"http:\/\/localhost\/wordpress\/thoughts-on-creating-thumbnails-in-the-browser\/"},"modified":"2022-03-09T17:42:58","modified_gmt":"2022-03-09T17:42:58","slug":"thoughts-on-creating-thumbnails-in-the-browser","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/thoughts-on-creating-thumbnails-in-the-browser\/","title":{"rendered":"Thoughts on creating thumbnails in the browser?"},"content":{"rendered":"\n<p>I&#8217;m looking for a general opinion here.<\/p>\n<p>I first wrote code to crop\/scale\/thumbnail an uploaded image 20 years ago using perl and ImageMagick. Not a lot has changed so far as I can tell. However, the last time I built one of these systems was on a low memory cloud instances and occasionally some large files would blow out memory and fail.<\/p>\n<p>This got me thinking that this could be done in the browser using HTML5 canvas and native browser operations. The browser does the heavy lifting and the server can just move files to CDN and such.<\/p>\n<p>My thought is:<\/p>\n<p>* User selects file via HTML file upload input<br \/>\n   * File is read via a FileReader object and the dataUrl is set to the src of an invisible Image object<br \/>\n   * An HTML5 canvas element is then written to using drawImage with the Image, and appropriate scaling arguments to create the thumbnail<br \/>\n* Finally, the user clicks &#8220;save&#8221; and the server generates a secured upload\\_url to upload the file to a temp storage bucket (signed Google Cloud Storage url or similar)<br \/>\n   * Canvas content is read as a dataUrl and converted to the appropriate blob data for the POST request to the upload\\_url where the file is written to the temp bucket<br \/>\n   * Upon completion of upload, a callback to the server is fired and the file is moved from the temp bucket to it&#8217;s permanent readonly location on the cdn, database updated, etc.<\/p>\n<p>So what am I not thinking of in terms of security, etc? Cross Browser support etc?<br \/>\nI&#8217;m assuming others have reached this result considering these browser apis have been around a while.  <\/p>\n<p>edit. What is outline above I have working as a proof of concept and works great although I have not cross browser tested yet. <\/p>\n<p>&amp;#x200B;<\/p>\n\n","protected":false},"excerpt":{"rendered":"<p>I&#8217;m looking for a general opinion here. I first wrote code to crop\/scale\/thumbnail an uploaded image 20 years ago using perl and ImageMagick. Not a lot has changed so far as I can tell. However, the last time I built one of these systems was on a low memory cloud instances and occasionally some large &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/thoughts-on-creating-thumbnails-in-the-browser\/\"> <span class=\"screen-reader-text\">Thoughts on creating thumbnails in the browser?<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1340"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=1340"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1340\/revisions"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=1340"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=1340"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=1340"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}