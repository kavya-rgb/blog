{"id":1446,"date":"2022-03-10T06:55:14","date_gmt":"2022-03-10T06:55:14","guid":{"rendered":"http:\/\/localhost\/wordpress\/deploying-a-react-application-to-aws-cloudfront\/"},"modified":"2022-03-10T06:55:14","modified_gmt":"2022-03-10T06:55:14","slug":"deploying-a-react-application-to-aws-cloudfront","status":"publish","type":"post","link":"http:\/\/localhost\/wordpress\/deploying-a-react-application-to-aws-cloudfront\/","title":{"rendered":"Deploying a React Application to AWS Cloudfront"},"content":{"rendered":"<p> <br \/>\n<\/p>\n<div data-article-id=\"1017585\" id=\"article-body\">\n<p>Ever wondered how to deploy your single page React application to AWS Cloudfront service?. In this article I would be showing you how to deploy a sample React application to AWS Cloudfront<\/p>\n<p>We would be deploying <\/p>\n<ul>\n<li>Manually using AWS cloud console<\/li>\n<li>Automated using Github Action<\/li>\n<\/ul>\n<h5>\n  <a name=\"components\" href=\"#components\"><br \/>\n  <\/a><br \/>\n  Components<br \/>\n<\/h5>\n<p><a href=\"https:\/\/aws.amazon.com\/cloudfront\/\">AWS Cloudfront<\/a>:  This is a content delivery network (CDN) provided by Amazon. Users access content through AWS nearest edge location. It can be used for delivering fast and secure websites, accelerate dynamic content delivery and api\u2019s, stream live and on demand video.<\/p>\n<p><a href=\"https:\/\/aws.amazon.com\/s3\/\">AWS S3<\/a>: This is a cost effective, highly performant object storage service provided by Amazon. It allows you to store objects such as documents, video, images, blobs, etc. It can be used for backups, cold storage, file storage, archiving, web frontend host, etc.<\/p>\n<p><a href=\"https:\/\/github.com\/features\/actions\">Github Action<\/a>: Github Action is an automation tool for automating developers workflows, just like CircleCI, Jenkins,  it can be used to create CI\/CD pipelines.<\/p>\n<p><strong>Deployment<\/strong><br \/>As shown on the diagram below, we would be uploading our static assets (html,js,css) to S3 and then creating a Cloudfront distribution to use the uploaded asset. On subsequent deployments we would invalidate the existing distribution to enable Cloudfront fetch new content from S3.<\/p>\n<p><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--iz01LiXg--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/4b7n8wm9v8pspsumz53e.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--iz01LiXg--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/4b7n8wm9v8pspsumz53e.png\" alt=\"Image description\" loading=\"lazy\" width=\"441\" height=\"421\"\/><\/a><\/p>\n<p><strong>Manual Deployment<\/strong><br \/>In order to manually deploy to Cloudfront ensure you have the following<\/p>\n<ul>\n<li>An AWS account with access to create S3 buckets and Objects as well as create Cloudfront distribution. Your normal AWS account would do, if you\u2019re an IAM user ensure you have those permissions<\/li>\n<li>A sample React application, you can clone one <a href=\"https:\/\/github.com\/Oliver-ke\/cf-deploy\">here<\/a>\n<\/li>\n<\/ul>\n<p>First, let&#8217;s get our static assets ready. Depending on your package manager (npm or yarn) run <code>npm install<\/code> to install dependencies and <code>npm run build<\/code> to build project, doing this would populate our build folder with the built assets (html,css,js etc)<\/p>\n<p>Next, Open your browser and login to your AWS account, search and select S3 from services, create a new bucket with the following fields<\/p>\n<p><em>Bucket name: Enter a globally unique name<\/em><br \/>Leave the other fields default, and click \u201ccreate bucket\u201d.<\/p>\n<p>Click to Select the newly created bucket, click upload and upload all files in the build folder.<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--tzLw6j_6--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/tjycdvoffzb0uto2g8dz.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--tzLw6j_6--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/tjycdvoffzb0uto2g8dz.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"636\"\/><\/a><\/p>\n<p>Next, create a Cloudfront distribution, search and select Cloudfront from services, click \u201ccreate distribution\u201d,  on the creation form, do the following<\/p>\n<p><em>Origin domain: select your new s3 bucket name<\/em><br \/><em>S3 bucket access: select \u201cYes use OAI (bucket can restrict access to only CloudFront)\u201d<\/em><br \/><em>Origin access identity: click \u201cCreate new OAI\u201d<\/em><br \/><em>Bucket policy: select \u201cYes, update the bucket policy\u201d<\/em><br \/>Click \u201cCreate distribution\u201d<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--bJOpfzhY--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/t6bjghcjgl0vlebo6uk0.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--bJOpfzhY--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/t6bjghcjgl0vlebo6uk0.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"737\"\/><\/a><\/p>\n<p>This would create a  new distribution and update your S3 bucket policy, allowing Cloudfront to get objects.<\/p>\n<p>Next, lets update the distribution error pages, Click on your newly created distribution and at the top tab menu click \u201cError pages\u201d, then click \u201cCreate custom error response\u201d, fill in the following<\/p>\n<p><em>HTTP error code: select \u201c443: Forbidden\u201d<\/em><br \/><em>Error caching minimum TTL: enter 30<\/em><br \/><em>Customize error response: select \u201cYes\u201d<\/em> <br \/><em>Response page path: enter \u201c\/index.html\u201d<\/em> without the quotes<br \/><em>HTTP Response code: select \u201c200:OK\u201d<\/em> <\/p>\n<p>Finally, click \u201cCreate custom error response\u201d.<br \/>Repeat these steps with HTTP error code \u201c404\u201d<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--1YZ12VpS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/uyvu636v01w5okts2sfz.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--1YZ12VpS--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/uyvu636v01w5okts2sfz.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"308\"\/><\/a><\/p>\n<p>Finally, let&#8217;s check our application. With the distribution selected, click on the \u201cGeneral\u201d tab, under details, click on the square like icon to copy the distribution domain name, paste this on a new browser tab to test application deployment.<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Sdilzdp5--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/61wwf6towmubnkml60uj.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--Sdilzdp5--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/61wwf6towmubnkml60uj.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"308\"\/><\/a><\/p>\n<p><em>Note: ensure you\u2019re not seeing a \u201cDeploying\u201d status under Last Modified, if so wait till it\u2019s complete.<\/em><\/p>\n<p>After all these is done, when next you update your application code, and needs to redeploy, just build and re-upload your new assets to the same bucket created earlier, this would overwrite the existing files, then move over to your cloudfront distribution, selected distribution and click on the \u201cInvalidations\u201d tab, click \u201cCreate invalidation\u201d, under \u201cAdd object paths\u201d enter <code>\/*<\/code>, finally click \u201cCreate invalidation\u201d. This would invalidate the cached assets on Cloudfront while updating the distribution with the newly uploaded assets on S3.<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--_iQkDGB3--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/yu4k2z2udszri2zf9opv.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--_iQkDGB3--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/yu4k2z2udszri2zf9opv.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"308\"\/><\/a><\/p>\n<p><strong>Automating Deployment with Github Action<\/strong><br \/>Here we would be automating the manual steps above using Github Action, to follow along ensure you have the following<\/p>\n<ul>\n<li>AWS CLI user, this can be done by going to IAM service on AWS console, and creating a new user with programmatic access and Administrative permission, copy the account secret id and secret key, we would be needing it<\/li>\n<li>Github repository with sample react application<\/li>\n<\/ul>\n<p>With our S3 bucket and Cloudfront distribution created, we would be using Github Action to automate building and deployment of our frontend application whenever a push is made to the repository\u2019s master branch.<\/p>\n<p>First, on S3 we\u2019ll need to enable Access Control List (ACL) to allow our CLI user with programmatic access to push objects to an S3 bucket created by another user. Open your bucket, click on the permissions tab, scroll down to Object Ownership, click edit, select \u201cACLs enabled\u201d, select \u201cObject writer\u201d and click \u201cSave changes\u201d,  scroll down to  \u201cAccess control list (ACL)\u201d while on permissions tab check that your CLI user canonical id is on the ACL, if it isn\u2019t add it by clicking edit, click add \u201cgrantee\u201d, paste in your CLI user canonical id and select \u201clist\u201d, \u201cwrite\u201d access then click \u201cSave changes\u201d. <br \/><em>Note:  you can run the following command on your terminal to check your CLI user canonical id <code>aws s3api list-buckets --query Owner.ID --output text<\/code>, ensure you have AWS CLI with credentials setup on your terminal before doing this<\/em><br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--lTTWUzLL--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/oa1chf86fekvokt32t84.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--lTTWUzLL--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/oa1chf86fekvokt32t84.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"677\"\/><\/a><\/p>\n<p>Next,  push your sample application code to Github, login to Github and select the repository, click on the settings tab<\/p>\n<p>Let\u2019s add secrets that\u2019ll be used in Github action, on the sidebar menu, click \u201cSecrets\u201d, then click \u201cActions\u201d, click \u201cNew repository secret\u201d to add a repository secret that would be used by Github Action.<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--1yCVvCij--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/138f5ap639zqwousk9hh.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--1yCVvCij--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/138f5ap639zqwousk9hh.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"476\"\/><\/a><\/p>\n<p>Next, enter the name of the key <code>AWS_ACCESS_KEY_ID<\/code>, and for value, paste in the value of your programmatic AWS user access key id, click \u201cAdd secret\u201d. Repeat this step for <code>AWS_SECRET_ACCESS_KEY<\/code> and \u201cAWS_DEFAULT_REGION\u201d, for <code>AWS_DEFAULT_REGION<\/code> you can type in any region of choice such as <code>us-east-1<\/code>. <br \/>Here you can also add any environment variable used by your application<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--hagugOqh--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/wengof1avkqu96hli0va.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--hagugOqh--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/wengof1avkqu96hli0va.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"379\"\/><\/a><\/p>\n<p>Next, create an action workflow file for our project, still on the repository, click \u201cActions\u201d, click \u201cset up a workflow yourself\u201d and paste in the script below.<\/p>\n<div class=\"highlight js-code-highlight\">\n<pre class=\"highlight plaintext\"><code>name: Frontend Cloudfront Deployment\n\non:\n  push:\n    branches:\n      - master\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node-version: [12.x]\n    steps:\n    - uses: actions\/checkout@v2\n\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions\/setup-node@v1\n      with:\n        node-version: ${{ matrix.node-version }}\n\n    - name: Yarn Install\n      run: yarn install\n\n    - name: Yarn Build\n      run: yarn build\n      env:\n        REACT_APP_API_URL: ${{ secrets.REACT_APP_API_URL }}\n\n    - name: Share artifact inside workflow\n      uses: actions\/upload-artifact@v1\n      with:\n        name: build-artifact\n        path: build\n\n  deploy:\n    runs-on: ubuntu-latest\n    needs: build\n    steps:\n      # get build artifact\n      - name: Get artifact\n        uses: actions\/download-artifact@v1\n        with:\n          name: build-artifact\n\n      - name: Configure AWS credentials\n        uses: aws-actions\/configure-aws-credentials@v1\n        with:\n          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n          aws-region: ${{ secrets.AWS_DEFAULT_REGION }}\n\n      # Copy build to s3\n      - name: Deploy to S3\n        run: |\n          S3_BUCKET=s3:\/\/&lt;s3-bucket-name&gt;\n          aws s3 sync . $S3_BUCKET --acl private\n        working-directory: build-artifact\n\n      - name: Create Cloudfront Invalidation\n        run: |\n          DISTRIBUTION_ID=&lt;distribution-id&gt;\n          aws cloudfront create-invalidation --distribution-id $DISTRIBUTION_ID --paths \/*\n        working-directory: build-artifact\n<\/code><\/pre>\n<div class=\"highlight__panel js-actions-panel\">\n<div class=\"highlight__panel-action js-fullscreen-code-action\">\n    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"><title>Enter fullscreen mode<\/title>\n    <path d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\/>\n<\/svg><\/p>\n<p>    <svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"><title>Exit fullscreen mode<\/title>\n    <path d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\/>\n<\/svg><\/p>\n<\/div>\n<\/div>\n<\/div>\n<p>Replace <code>&lt;s3-bucket-name&gt;<\/code> and <code>&lt;distribution-id&gt;<\/code> with your bucket name and distribution id respectively. From the script you can find references to our secrets created earlier. <br \/>Click \u201cStart commit\u201d, add a commit message and commit directly to master.<br \/><a href=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--d4OLJJfD--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/q6oakeb1hsdwxjkgg9us.png\" class=\"article-body-image-wrapper\"><img src=\"https:\/\/res.cloudinary.com\/practicaldev\/image\/fetch\/s--d4OLJJfD--\/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\/https:\/\/dev-to-uploads.s3.amazonaws.com\/uploads\/articles\/q6oakeb1hsdwxjkgg9us.png\" alt=\"Image description\" loading=\"lazy\" width=\"880\" height=\"465\"\/><\/a><\/p>\n<p>Finally, click on \u201cActions\u201d to see your newly created workflow running, once this is completed, open your Cloudfront url to see the updated application.<\/p>\n<p>I\u2019m glad we made it this far \ud83d\udc4f, we\u2019ve covered a lot. For a more detailed explanation please check the video <a href=\"https:\/\/youtu.be\/l8mFrSfSGOU\">here<\/a>. I made a video to properly explain the steps, so if you\u2019re having issues just watch the video.<\/p>\n<p>Perhaps you find this helpful, please leave a LIKE, Cheers!<\/p>\n<\/p><\/div>\n\n","protected":false},"excerpt":{"rendered":"<p>Ever wondered how to deploy your single page React application to AWS Cloudfront service?. In this article I would be showing you how to deploy a sample React application to AWS Cloudfront We would be deploying Manually using AWS cloud console Automated using Github Action Components AWS Cloudfront: This is a content delivery network (CDN) &hellip;<\/p>\n<p class=\"read-more\"> <a class=\"\" href=\"http:\/\/localhost\/wordpress\/deploying-a-react-application-to-aws-cloudfront\/\"> <span class=\"screen-reader-text\">Deploying a React Application to AWS Cloudfront<\/span> Read More &raquo;<\/a><\/p>\n","protected":false},"author":1,"featured_media":1447,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"site-sidebar-layout":"default","site-content-layout":"default","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":""},"categories":[1],"tags":[],"_links":{"self":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1446"}],"collection":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/comments?post=1446"}],"version-history":[{"count":0,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/posts\/1446\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media\/1447"}],"wp:attachment":[{"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/media?parent=1446"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/categories?post=1446"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost\/wordpress\/wp-json\/wp\/v2\/tags?post=1446"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}